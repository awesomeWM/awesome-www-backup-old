<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-AU" xml:lang="en-AU">
  <head>
    <title>FS#1286 : Thunar crashes when the thunar tray icon has been displayed</title>

    <meta name="description" content="Flyspray, a Bug Tracking System written in PHP." />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Script-Type" content="text/javascript" />
    <meta http-equiv="Content-Style-Type" content="text/css" />

    <link rel="icon" type="image/png" href="https://awesomewm.org/bugs/themes/Bluey/favicon.ico" />
    <link rel="index" id="indexlink" type="text/html" href="https://awesomewm.org/bugs/" />
        <link media="screen" href="https://awesomewm.org/bugs/themes/Bluey/theme.css" rel="stylesheet" type="text/css" />
    <link media="print"  href="https://awesomewm.org/bugs/themes/Bluey/theme_print.css" rel="stylesheet" type="text/css" />
    <link rel="alternate" type="application/rss+xml" title="Flyspray RSS 1.0 Feed"
          href="https://awesomewm.org/bugs/feed.php?feed_type=rss1&amp;project=1" />
    <link rel="alternate" type="application/rss+xml" title="Flyspray RSS 2.0 Feed"
          href="https://awesomewm.org/bugs/feed.php?feed_type=rss2&amp;project=1" />
	<link rel="alternate" type="application/atom+xml" title="Flyspray Atom 0.3 Feed"
	      href="https://awesomewm.org/bugs/feed.php?feed_type=atom&amp;project=1" />

    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/prototype/prototype.js"></script>
    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/script.aculo.us/scriptaculous.js"></script>
            <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/details.js"></script>
                <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/tabs.js"></script>
    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/functions.js"></script>
    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/jscalendar/calendar_stripped.js"></script>
    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/jscalendar/calendar-setup_stripped.js"> </script>
    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/jscalendar/lang/calendar-en.js"></script>
    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/lightbox/js/lightbox.js"></script>
    <link rel="stylesheet" href="https://awesomewm.org/bugs/javascript/lightbox/css/lightbox.css" type="text/css" media="screen" />
    <!--[if IE]>
    <link media="screen" href="https://awesomewm.org/bugs/themes/Bluey/ie.css" rel="stylesheet" type="text/css" />
    <![endif]-->
      </head>
  <body onload="perms = new Perms('permissions');">

  <div id="container">
    <!-- Remove this to remove the logo -->
    <h1 id="title"><a href="https://awesomewm.org/bugs/">awesome</a></h1>

    <div id="menu">

<form id="login" action="https://awesomewm.org/bugs/index.php?do=authenticate" method="post">
<div>
  <label for="lbl_user_name">Username</label>
  <input class="text" type="text" id="lbl_user_name" name="user_name" size="17" maxlength="30" />

  <label for="lbl_password">Password</label>
  <input class="password" type="password" id="lbl_password" name="password" size="17" maxlength="30" />

  <label for="lbl_remember">Remember me</label>
  <input type="checkbox" id="lbl_remember" name="remember_login" />
  
  <input type="hidden" name="return_to" value="/bugs/index.php?do=details&amp;task_id=1286&amp;project=0&amp;pagenum=5" />

  <button accesskey="l" type="submit">Login!</button>

  <span id="links">
            <a id="forgotlink" href="https://awesomewm.org/bugs/index.php?do=lostpw">Lost password?</a>
      </span>
</div>
</form>
</div>

<div id="pm-menu">

<div id="projectselector">
    <form id="projectselectorform" action="https://awesomewm.org/bugs/index.php" method="get">
       <div>
        <select name="project" onChange="document.getElementById('projectselectorform').submit()">
          <option value="0">All Projects</option>        </select>
        <button type="submit">Switch</button>
        <input type="hidden" name="do" value="details" />
        <input type="hidden" value="1" name="switch" />
              </div>
    </form>
</div>

<ul id="pm-menu-list">
    <li class="first">
      <a id="toplevellink" href="https://awesomewm.org/bugs/index.php?do=toplevel&amp;project=1">Overview</a>
    </li>

    <li>
    <a id="homelink"
        href="https://awesomewm.org/bugs/index.php?project=1&amp;do=index">Tasklist</a>
    </li>

    
    
        <li>
    <a id="roadmaplink"
        href="https://awesomewm.org/bugs/index.php?do=roadmap&amp;project=1">Roadmap</a>
    </li>
    
    
    </ul>
</div>

    
    <div id="content">
      <div id="showtask">
        <form action="https://awesomewm.org/bugs/index.php" method="get">
          <div>
            <button type="submit">Show Task #</button>
            <input id="taskid" name="show_task" class="text" type="text" size="10" accesskey="t" />
          </div>
        </form>
      </div>

      <div class="clear"></div>
            <div id="intromessage">Welcome to awesome bug tracking system.</div>
      <div id="taskdetails">
<span id="navigation">   <a href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=1287&amp;project=0&amp;pagenum=5" title="Unconfirmed | Margin between tags | 0%"  id = "prev" accesskey = "p">Previous task</a>     |     <a href="https://awesomewm.org/bugs/index.php?project=1&amp;do=index&amp;pagenum=5">Tasklist</a>
   |     <a href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=1285&amp;project=0&amp;pagenum=5" title="Unconfirmed | Global keys not response while mouse down (dragging) | 0%"  id = "next" accesskey = "n">Next task</a>  </span>

  <h2 class="summary severity3">
	 FS#1286 - Thunar crashes when the thunar tray icon has been displayed  </h2>

  <div id="fineprint">
	 Attached to Project:
	 <a href="/bugs/index.php?project=1">awesome</a>
	 <br />
	 Opened by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=994">bob (getzze)</a>     	 - Monday, 21 July 2014, 19:49 GMT 	   </div>

  <table><tr><td id="taskfieldscell">
  <div id="taskfields">
	 <table>
		<tr>
		  <th id="tasktype">Task Type</th>
		  <td headers="tasktype">Bug Report</td>
		</tr>
		<tr>
		  <th id="category">Category</th>
		  <td headers="category">
			 			 Lua libraries &#8594;
			 			 wibox		  </td>
		</tr>
		<tr>
		  <th id="status">Status</th>
		  <td headers="status">
			 			 Unconfirmed               			 		  </td>
		</tr>
		<tr>
		  <th id="assignedto">Assigned To</th>
		  <td headers="assignedto">
			 			 No-one			 		  </td>
		</tr>
		<tr>
		  <th id="os">Operating System</th>
		  <td headers="os">Linux</td>
		</tr>
		<tr>
		  <th id="severity">Severity</th>
		  <td headers="severity">Medium</td>
		</tr>
		<tr>
		  <th id="priority">Priority</th>
		  <td headers="priority">Normal</td>
		</tr>
		<tr>
		  <th id="reportedver">Reported Version</th>
		  <td headers="reportedver">3.5.5</td>
		</tr>
		<tr>
		  <th id="dueversion">Due in Version</th>
		  <td headers="dueversion">
			 			 Undecided			 		  </td>
		</tr>
		<tr>
		  <th id="duedate">Due Date</th>
		  <td headers="duedate">
			 Undecided		  </td>
		</tr>
		<tr>
		  <th id="percent">Percent Complete</th>
		  <td headers="percent">
			 <img src="https://awesomewm.org/bugs/themes/Bluey/percent-0.png"
				title="0% complete"
				alt="0%" />
		  </td>
		</tr>
        <tr class="votes">
		  <th id="votes">Votes</th>
		  <td headers="votes">
                    <a href="javascript:showhidestuff('showvotes')">1 </a>
          <div id="showvotes" class="hide">
              <ul class="reports">
                              <li><a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=1043">James Duley (parched)</a> (2015-08-29)</li>
                            </ul>
          </div>
                              </td>
        </tr>
        <tr>
		  <th id="private">Private</th>
		  <td headers="private">
                        No            
                      </td>
        </tr>
        	 </table>
  </div>

  </td><td>

  <div id="taskdetailsfull">
	 <h3 class="taskdesc">Details</h3>
     <div id="taskdetailstext">The bug is described in:<br /><a href="
https://bugzilla.redhat.com/show_bug.cgi?id=986868">
https://bugzilla.redhat.com/show_bug.cgi?id=986868</a><br />
<br />
It is not clear if it is a thunar problem or an awesomewm problem, but it is related to wibox.widget.systray. Thunar crashes when a new tab is created after the tray icon has been displayed in the wibox systray (thunar does not crash if wibox systray is not loaded).<br />
The procedure to reproduce the bug is described in the linked page and reported here:<br />
<br />
&quot;Ok, it happened many times more and now I know how to reproduce it. It seems it happens when I&#039;m running AwesomeWM.<br />
<br />
Steps to reproduce:<br />
<br />
1) run awesome as your window manager<br />
2) open Thunar<br />
3) open new tab in Thunar with Ctrl-T<br />
4) do some copying operation that displays the &quot;File Operation Progress&quot; popup and a tray icon (this is required, the bug doesn&#039;t appear when the operation is quick and without the popup/tray icon)<br />
5) wait for the operation to finish or just cancel it<br />
6) try switching to the other Thunar tab - crash should happen <br />
<br />
I tried the above procedure under XFCE4 and it works fine so it seems there is something wrong on the line between Awesome&#039;s tray implementation and Thunar&#039;s use of a tray.&quot;<br />
<br />
I could not try the git version of awesome to confirm the bug there.<br /></div>

       
  </div>

  </td></tr></table>

  <div id="taskinfo">
	 <div id="taskdeps">
		<b>This task depends upon</b>
		<br />
		
		<br class="DoNotPrint" />

		
			 </div>

	 <div id="taskblocks">
        			 </div>
  </div>

  
  <div id="actionbuttons">
	 
	 
	 
	 
	 
	 	   </div>
</div>
<ul id="submenu">
    <li id="commentstab">
  <a href="#comments">Comments (5)</a>
  </li>
  
  <li id="relatedtab">
  <a href="#related">Related Tasks (0/0)</a>
  </li>

  
  </ul>
<div id="comments" class="tab">
    <em>
    <a name="comment4109" id="comment4109"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=1286#comment4109">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=289">Uli Schlachter (psychon)</a> -
    Monday, 21 July 2014, 20:28 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">A program should never just crash, even if the WM is doing something wrong. And I don&#039;t really feel like investigating something that looks like it is just a GTK bug, sorry.</div></div>

  
    <em>
    <a name="comment4110" id="comment4110"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=1286#comment4110">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=994">bob (getzze)</a> -
    Monday, 21 July 2014, 22:39 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">It cannot be a problem in awesome also? Like for example that awesome connects the systray icon to the systray but does not destroy the connection when the tray icon disappears.<br />
In the source code of systray.c, in the function `systray_request_handle`, there is for example the function xcb_reparent_window which is applied to the tray icon. It does not seem to be undone. I don&#039;t know anything about Xcb API so maybe it is not critical.<br />
I will try to file this bug to thunar developers also, or maybe gtk if you think it is more related to gtk.<br />
Thanks</div></div>

  
    <em>
    <a name="comment4111" id="comment4111"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=1286#comment4111">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=289">Uli Schlachter (psychon)</a> -
    Tuesday, 22 July 2014, 08:05 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">The reason why the systray &quot;grabs&quot; icons, but doesn&#039;t let go of them again: Either the program just destroys its icon (this is handled via event_handle_destroynotify or _unmapnotify in event.c) or awesome exits, its systray window is destroyed and thanks to the magic of the save set, the embedded systray icons are automatically reparented back to the root window.<br />
<br />
I am not saying that awesome doesn&#039;t do something wrong, but I am saying that this shouldn&#039;t make thunar crash. And from the backtrace in that bug report, it crashes in some GTK function that tries to access some systray icon&#039;s private data. No idea how that could possibly cause a segfault, but that segfault certainly is thunar&#039;s problem. When they fixed their code to complain instead of to crash when/if awesome does something wrong, then I can get a hint at what&#039;s wrong, until then this is certainly &quot;their&quot; bug.</div></div>

  
    <em>
    <a name="comment4112" id="comment4112"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=1286#comment4112">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=994">bob (getzze)</a> -
    Tuesday, 22 July 2014, 12:46 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">Bug reported to thunar maintainers:<br /><a href="
https://bugzilla.xfce.org/show_bug.cgi?id=11035">
https://bugzilla.xfce.org/show_bug.cgi?id=11035</a><br />
<br />
Let&#039;s see what they can do.<br />
Thanks again</div></div>

  
    <em>
    <a name="comment4243" id="comment4243"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=1286#comment4243">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=1043">James Duley (parched)</a> -
    Saturday, 29 August 2015, 07:42 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">The gtk bug report is here<a href=" https://bugzilla.gnome.org/show_bug.cgi?id=747280"> https://bugzilla.gnome.org/show_bug.cgi?id=747280</a> maybe that can help the awesome maintainers determine if it is an awesome or gtk bug.</div></div>

  
  
  </div>
<div id="related" class="tab">
  <table>    <tr><td>
    <form method="post" action="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=1286#related" >
        <table id="tasks_related" class="userlist">
        <tr>
          <th>
            <a href="javascript:ToggleSelected('tasks_related')">
              <img title="Toggle Selected" alt="Toggle Selected" src="https://awesomewm.org/bugs/themes/Bluey/kaboodleloop.png" width="16" height="16" />
            </a>
          </th>
          <th>Tasks related to this task (0)</th>
        </tr>
                <tr>
          <td colspan="2">
            <input type="hidden" name="action" value="remove_related" />
            <input type="hidden" name="task_id" value="1286" />
            <button type="submit">Remove</button>
          </td>
        </tr>
        </table>
    </form>
    </td><td>
    
    <table id="duplicate_tasks" class="userlist">
        <tr>
          <th>Duplicate tasks of this task (0)</th>
        </tr>
            </table>
    </td></tr>
  </table>

  </div>
<div id="history" class="tab">
  <h3>Loading...</h3>
</div>
    </div>
    <p id="footer">
       <!-- Please don't remove this line - it helps promote Flyspray -->
       <a href="http://flyspray.org/" class="offsite">Powered by Flyspray</a>
    </p>
  </div>
  </body>
</html>
