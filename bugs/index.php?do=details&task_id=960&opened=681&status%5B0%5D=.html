<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-AU" xml:lang="en-AU">
  <head>
    <title>FS#960 : Awesome causes Lyx menu misbehaviour</title>

    <meta name="description" content="Flyspray, a Bug Tracking System written in PHP." />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Script-Type" content="text/javascript" />
    <meta http-equiv="Content-Style-Type" content="text/css" />

    <link rel="icon" type="image/png" href="https://awesomewm.org/bugs/themes/Bluey/favicon.ico" />
    <link rel="index" id="indexlink" type="text/html" href="https://awesomewm.org/bugs/" />
        <link media="screen" href="https://awesomewm.org/bugs/themes/Bluey/theme.css" rel="stylesheet" type="text/css" />
    <link media="print"  href="https://awesomewm.org/bugs/themes/Bluey/theme_print.css" rel="stylesheet" type="text/css" />
    <link rel="alternate" type="application/rss+xml" title="Flyspray RSS 1.0 Feed"
          href="https://awesomewm.org/bugs/feed.php?feed_type=rss1&amp;project=1" />
    <link rel="alternate" type="application/rss+xml" title="Flyspray RSS 2.0 Feed"
          href="https://awesomewm.org/bugs/feed.php?feed_type=rss2&amp;project=1" />
	<link rel="alternate" type="application/atom+xml" title="Flyspray Atom 0.3 Feed"
	      href="https://awesomewm.org/bugs/feed.php?feed_type=atom&amp;project=1" />

    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/prototype/prototype.js"></script>
    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/script.aculo.us/scriptaculous.js"></script>
            <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/details.js"></script>
                <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/tabs.js"></script>
    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/functions.js"></script>
    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/jscalendar/calendar_stripped.js"></script>
    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/jscalendar/calendar-setup_stripped.js"> </script>
    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/jscalendar/lang/calendar-en.js"></script>
    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/lightbox/js/lightbox.js"></script>
    <link rel="stylesheet" href="https://awesomewm.org/bugs/javascript/lightbox/css/lightbox.css" type="text/css" media="screen" />
    <!--[if IE]>
    <link media="screen" href="https://awesomewm.org/bugs/themes/Bluey/ie.css" rel="stylesheet" type="text/css" />
    <![endif]-->
      </head>
  <body onload="perms = new Perms('permissions');">

  <div id="container">
    <!-- Remove this to remove the logo -->
    <h1 id="title"><a href="https://awesomewm.org/bugs/">awesome</a></h1>

    <div id="menu">

<form id="login" action="https://awesomewm.org/bugs/index.php?do=authenticate" method="post">
<div>
  <label for="lbl_user_name">Username</label>
  <input class="text" type="text" id="lbl_user_name" name="user_name" size="17" maxlength="30" />

  <label for="lbl_password">Password</label>
  <input class="password" type="password" id="lbl_password" name="password" size="17" maxlength="30" />

  <label for="lbl_remember">Remember me</label>
  <input type="checkbox" id="lbl_remember" name="remember_login" />
  
  <input type="hidden" name="return_to" value="/bugs/index.php?do=details&amp;task_id=960&amp;opened=681&amp;status%5B0%5D=" />

  <button accesskey="l" type="submit">Login!</button>

  <span id="links">
            <a id="forgotlink" href="https://awesomewm.org/bugs/index.php?do=lostpw">Lost password?</a>
      </span>
</div>
</form>
</div>

<div id="pm-menu">

<div id="projectselector">
    <form id="projectselectorform" action="https://awesomewm.org/bugs/index.php" method="get">
       <div>
        <select name="project" onChange="document.getElementById('projectselectorform').submit()">
          <option value="0">All Projects</option>        </select>
        <button type="submit">Switch</button>
        <input type="hidden" name="do" value="details" />
        <input type="hidden" value="1" name="switch" />
              </div>
    </form>
</div>

<ul id="pm-menu-list">
    <li class="first">
      <a id="toplevellink" href="https://awesomewm.org/bugs/index.php?do=toplevel&amp;project=1">Overview</a>
    </li>

    <li>
    <a id="homelink"
        href="https://awesomewm.org/bugs/index.php?project=1&amp;do=index">Tasklist</a>
    </li>

    
    
        <li>
    <a id="roadmaplink"
        href="https://awesomewm.org/bugs/index.php?do=roadmap&amp;project=1">Roadmap</a>
    </li>
    
    
    </ul>
</div>

    
    <div id="content">
      <div id="showtask">
        <form action="https://awesomewm.org/bugs/index.php" method="get">
          <div>
            <button type="submit">Show Task #</button>
            <input id="taskid" name="show_task" class="text" type="text" size="10" accesskey="t" />
          </div>
        </form>
      </div>

      <div class="clear"></div>
            <div id="intromessage">Welcome to awesome bug tracking system.</div>
      <div id="taskdetails">
<span id="navigation">       <a href="https://awesomewm.org/bugs/index.php?project=1&amp;do=index&amp;opened=681&amp;status%5B0%5D=">Tasklist</a>
    </span>

  <h2 class="summary severity2">
	 FS#960 - Awesome causes Lyx menu misbehaviour  </h2>

  <div id="fineprint">
	 Attached to Project:
	 <a href="/bugs/index.php?project=1">awesome</a>
	 <br />
	 Opened by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=681">Sascha (ElkMonsterr)</a>     	 - Tuesday, 07 February 2012, 18:03 GMT 	   </div>

  <table><tr><td id="taskfieldscell">
  <div id="taskfields">
	 <table>
		<tr>
		  <th id="tasktype">Task Type</th>
		  <td headers="tasktype">Bug Report</td>
		</tr>
		<tr>
		  <th id="category">Category</th>
		  <td headers="category">
			 			 Core		  </td>
		</tr>
		<tr>
		  <th id="status">Status</th>
		  <td headers="status">
			 			 Unconfirmed               			 		  </td>
		</tr>
		<tr>
		  <th id="assignedto">Assigned To</th>
		  <td headers="assignedto">
			 			 No-one			 		  </td>
		</tr>
		<tr>
		  <th id="os">Operating System</th>
		  <td headers="os">All</td>
		</tr>
		<tr>
		  <th id="severity">Severity</th>
		  <td headers="severity">Low</td>
		</tr>
		<tr>
		  <th id="priority">Priority</th>
		  <td headers="priority">Normal</td>
		</tr>
		<tr>
		  <th id="reportedver">Reported Version</th>
		  <td headers="reportedver">git/master</td>
		</tr>
		<tr>
		  <th id="dueversion">Due in Version</th>
		  <td headers="dueversion">
			 			 Undecided			 		  </td>
		</tr>
		<tr>
		  <th id="duedate">Due Date</th>
		  <td headers="duedate">
			 Undecided		  </td>
		</tr>
		<tr>
		  <th id="percent">Percent Complete</th>
		  <td headers="percent">
			 <img src="https://awesomewm.org/bugs/themes/Bluey/percent-0.png"
				title="0% complete"
				alt="0%" />
		  </td>
		</tr>
        <tr class="votes">
		  <th id="votes">Votes</th>
		  <td headers="votes">
                    0
                              </td>
        </tr>
        <tr>
		  <th id="private">Private</th>
		  <td headers="private">
                        No            
                      </td>
        </tr>
        	 </table>
  </div>

  </td><td>

  <div id="taskdetailsfull">
	 <h3 class="taskdesc">Details</h3>
     <div id="taskdetailstext">It seems Awesome causes buggy behaviour in Lyx. Something prevents the input focus from being set back to Lyx&#039;s text input area when certain actions are performed in the menu using keyboard only (see below).<br />
Doesn&#039;t happen on the same system with Xfce. Neither Lyx devs nor Arch Linux forum members could reproduce the issue on their non-Awesome systems.<br />
<br />
Detailed report here:<a href=" http://www.lyx.org/trac/ticket/7984"> http://www.lyx.org/trac/ticket/7984</a><br />
Follow steps at comment #5 to reproduce.<br /></div>

       
  </div>

  </td></tr></table>

  <div id="taskinfo">
	 <div id="taskdeps">
		<b>This task depends upon</b>
		<br />
		
		<br class="DoNotPrint" />

		
			 </div>

	 <div id="taskblocks">
        			 </div>
  </div>

  
  <div id="actionbuttons">
	 
	 
	 
	 
	 
	 	   </div>
</div>
<ul id="submenu">
    <li id="commentstab">
  <a href="#comments">Comments (9)</a>
  </li>
  
  <li id="relatedtab">
  <a href="#related">Related Tasks (0/0)</a>
  </li>

  
  </ul>
<div id="comments" class="tab">
    <em>
    <a name="comment2858" id="comment2858"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=960#comment2858">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=289">Uli Schlachter (psychon)</a> -
    Wednesday, 08 February 2012, 17:16 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">I got bad news for you: I can&#039;t reproduce this either.<br />
<br />
Also, the WM doesn&#039;t really have anything to do with the app-internal input focus. It just controls which top-level window has the focus (and menus are done in a magic way which the WM can&#039;t influence, too)</div></div>

  
    <em>
    <a name="comment2859" id="comment2859"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=960#comment2859">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=289">Uli Schlachter (psychon)</a> -
    Wednesday, 08 February 2012, 17:19 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">Oh and before someone asks: Debian amd64 testing, lyx 2.0.2-1</div></div>

  
    <em>
    <a name="comment2860" id="comment2860"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=960#comment2860">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=681">Sascha (ElkMonsterr)</a> -
    Thursday, 09 February 2012, 00:06 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">Man, this is getting annoying... is there any way I can further investigate the issue? Does Awesome actually touch window toolkit stuff anywhere (i.e., setting focus to menus etc), is there some point where they interact with or depend on each other? I&#039;ll start some heavy thesis writing soon, and this thing will certainly break my mouse-less workflow... :(<br />
And before someone asks: I have double-triple-quadro-checked this. ;) And it occurs on two fully independent computers, their only things in common being the owner (well, and both running an (independently administrated) up-to-date Arch 64).</div></div>

  
    <em>
    <a name="comment2861" id="comment2861"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=960#comment2861">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=289">Uli Schlachter (psychon)</a> -
    Thursday, 09 February 2012, 08:51 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">Which exact awesome version are you using?<br />
<br />
And for what awesome is doing:<br />
<br />
When a menu is opened, an &quot;override redirect&quot; window is used. That means that the WM doesn&#039;t get any notification of this and that this window has to handle everything itself. When the menu closes, the last window which had the focus automatically gets it back.<br />
For what the WM has to do with windows: It only sees toplevel windows (which it e.g. lists in the tasklist). When it wants to focus a window, it can just focus the whole window. All the stuff internal to the window (including the menu bar when no menu is opened) isn&#039;t seen by the WM nor by the X11 server. The WM doesn&#039;t know about this and can&#039;t focus this.<br />
<br />
I tested this with awesome git/master, could some 3.4 user do a quick test with lyx? This really does not take long to test!</div></div>

  
    <em>
    <a name="comment2862" id="comment2862"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=960#comment2862">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=681">Sascha (ElkMonsterr)</a> -
    Thursday, 09 February 2012, 12:12 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">awesome v3.4-619-ge052bd9 (Closing In)<br />
 • Build: Feb  8 2012 03:28:51 for x86_64 by gcc version 4.6.2 (root@kueken)<br />
 • D-Bus support: ✔<br />
Before, I was using a build from November 2011 though (did an update to verify that issue still exists in latest git).<br />
I&#039;ve also checked with the default rc.lua now, just to be sure none of my custom config code is doing something wrong - but no, same thing happens.<br />
<br />
I guess I have to get used to checking the menu for the hovered effect it has when focused. If so, I can press Alt to un-focus it (no mouse required contrary to what I suggested before). It&#039;s just that when you want to type and you&#039;re really concentrated, every small disruptive factor becomes really annoying...</div></div>

  
    <em>
    <a name="comment2863" id="comment2863"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=960#comment2863">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=679">Alexander Yakushev (Alex.yakushev)</a> -
    Thursday, 09 February 2012, 13:51 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">I was able to reproduce it, version 3.4-617-gc6e9208 (Jan 27 2012). Everything is just like Sascha stated in the Lyx ticket.<br />
<br />
The bad news is that I also reproduced it in dwm and without any WM at all (started xterm in Xephyr and run Lyx from there). Seems like the bug is in X.org or it is  Lyx wrongfully doing the refocus (much likely).<br />
<br />
Another interesting moment is that if you just press Alt and navigate to the top level menu with arrows (no Alt-I or something) the bug won&#039;t reproduce.<br />
<br />
If the bug doesn&#039;t show up in XFCE/Gnome/etc than it is probably these DEs somehow messing with the in-window elements and that way &quot;fixing&quot; the bug. But It occurs to me that if:<br />
1) X.org has this bug by default (without any WMs)<br />
2) Other applications do not have such a bug<br />
Then the responsibility for fixing this lays completely on the Lyx developers&#039; shoulders.</div></div>

  
    <em>
    <a name="comment2864" id="comment2864"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=960#comment2864">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=289">Uli Schlachter (psychon)</a> -
    Thursday, 09 February 2012, 17:15 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">So you guys are using git/master, too? Whoa. That already rules out non-reparenting WMs (but it still does happen in dwm....).<br />
<br />
Another update on the focus thing: I think that qt doesn&#039;t actually create subwindows. It just has a single, toplevel window and it draws everything directly into that. This makes a bug in the Xserver even more unlikely.<br />
However, this also means that other WMs can&#039;t really mess with the in-window elements because there are just pixels, no more windows.<br />
<br />
Could someone ping some LyX devs? Hopefully one of them can reproduce without any WM at all. If not, I&#039;d be curious for some help around their source code. Perhaps they are doing some unusual magic with their menus which confuses qt? Perhaps some magic with the keybindings? (But I guess no one will step and say &quot;oh yeah, we are doing this hack here and obviously it&#039;s wrong)</div></div>

  
    <em>
    <a name="comment2865" id="comment2865"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=960#comment2865">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=681">Sascha (ElkMonsterr)</a> -
    Thursday, 09 February 2012, 19:17 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">I&#039;ve informed Lyx devs of this bug report and Alexander&#039;s discovery.</div></div>

  
    <em>
    <a name="comment2967" id="comment2967"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=960#comment2967">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=681">Sascha (ElkMonsterr)</a> -
    Thursday, 26 April 2012, 12:19 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">Just to keep you informed: I&#039;ve opened a bug in the QT project bug tracker, but not a single reaction there for two weeks:<a href=" https://bugreports.qt-project.org/browse/QTBUG-25156"> https://bugreports.qt-project.org/browse/QTBUG-25156</a><br />
<br />
Also, I found out that one can work around the bug in a pretty simple way. The single important step is to press ALT separately to focus the menu bar (instead of directly selecting the wished menu, like ALT+i for &quot;Insert&quot; menu), then use letter or arrow keys to navigate.</div></div>

  
  
  </div>
<div id="related" class="tab">
  <table>    <tr><td>
    <form method="post" action="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=960#related" >
        <table id="tasks_related" class="userlist">
        <tr>
          <th>
            <a href="javascript:ToggleSelected('tasks_related')">
              <img title="Toggle Selected" alt="Toggle Selected" src="https://awesomewm.org/bugs/themes/Bluey/kaboodleloop.png" width="16" height="16" />
            </a>
          </th>
          <th>Tasks related to this task (0)</th>
        </tr>
                <tr>
          <td colspan="2">
            <input type="hidden" name="action" value="remove_related" />
            <input type="hidden" name="task_id" value="960" />
            <button type="submit">Remove</button>
          </td>
        </tr>
        </table>
    </form>
    </td><td>
    
    <table id="duplicate_tasks" class="userlist">
        <tr>
          <th>Duplicate tasks of this task (0)</th>
        </tr>
            </table>
    </td></tr>
  </table>

  </div>
<div id="history" class="tab">
  <h3>Loading...</h3>
</div>
    </div>
    <p id="footer">
       <!-- Please don't remove this line - it helps promote Flyspray -->
       <a href="http://flyspray.org/" class="offsite">Powered by Flyspray</a>
    </p>
  </div>
  </body>
</html>
