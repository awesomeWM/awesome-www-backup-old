<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-AU" xml:lang="en-AU">
  <head>
    <title>FS#699 : hiding toplevel windows is not supported</title>

    <meta name="description" content="Flyspray, a Bug Tracking System written in PHP." />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Script-Type" content="text/javascript" />
    <meta http-equiv="Content-Style-Type" content="text/css" />

    <link rel="icon" type="image/png" href="https://awesomewm.org/bugs/themes/Bluey/favicon.ico" />
    <link rel="index" id="indexlink" type="text/html" href="https://awesomewm.org/bugs/" />
        <link media="screen" href="https://awesomewm.org/bugs/themes/Bluey/theme.css" rel="stylesheet" type="text/css" />
    <link media="print"  href="https://awesomewm.org/bugs/themes/Bluey/theme_print.css" rel="stylesheet" type="text/css" />
    <link rel="alternate" type="application/rss+xml" title="Flyspray RSS 1.0 Feed"
          href="https://awesomewm.org/bugs/feed.php?feed_type=rss1&amp;project=1" />
    <link rel="alternate" type="application/rss+xml" title="Flyspray RSS 2.0 Feed"
          href="https://awesomewm.org/bugs/feed.php?feed_type=rss2&amp;project=1" />
	<link rel="alternate" type="application/atom+xml" title="Flyspray Atom 0.3 Feed"
	      href="https://awesomewm.org/bugs/feed.php?feed_type=atom&amp;project=1" />

    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/prototype/prototype.js"></script>
    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/script.aculo.us/scriptaculous.js"></script>
            <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/details.js"></script>
                <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/tabs.js"></script>
    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/functions.js"></script>
    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/jscalendar/calendar_stripped.js"></script>
    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/jscalendar/calendar-setup_stripped.js"> </script>
    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/jscalendar/lang/calendar-en.js"></script>
    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/lightbox/js/lightbox.js"></script>
    <link rel="stylesheet" href="https://awesomewm.org/bugs/javascript/lightbox/css/lightbox.css" type="text/css" media="screen" />
    <!--[if IE]>
    <link media="screen" href="https://awesomewm.org/bugs/themes/Bluey/ie.css" rel="stylesheet" type="text/css" />
    <![endif]-->
      </head>
  <body onload="perms = new Perms('permissions');">

  <div id="container">
    <!-- Remove this to remove the logo -->
    <h1 id="title"><a href="https://awesomewm.org/bugs/">awesome</a></h1>

    <div id="menu">

<form id="login" action="https://awesomewm.org/bugs/index.php?do=authenticate" method="post">
<div>
  <label for="lbl_user_name">Username</label>
  <input class="text" type="text" id="lbl_user_name" name="user_name" size="17" maxlength="30" />

  <label for="lbl_password">Password</label>
  <input class="password" type="password" id="lbl_password" name="password" size="17" maxlength="30" />

  <label for="lbl_remember">Remember me</label>
  <input type="checkbox" id="lbl_remember" name="remember_login" />
  
  <input type="hidden" name="return_to" value="/bugs/index.php?do=details&amp;task_id=699&amp;opened=319&amp;status%5B0%5D=" />

  <button accesskey="l" type="submit">Login!</button>

  <span id="links">
            <a id="forgotlink" href="https://awesomewm.org/bugs/index.php?do=lostpw">Lost password?</a>
      </span>
</div>
</form>
</div>

<div id="pm-menu">

<div id="projectselector">
    <form id="projectselectorform" action="https://awesomewm.org/bugs/index.php" method="get">
       <div>
        <select name="project" onChange="document.getElementById('projectselectorform').submit()">
          <option value="0">All Projects</option>        </select>
        <button type="submit">Switch</button>
        <input type="hidden" name="do" value="details" />
        <input type="hidden" value="1" name="switch" />
              </div>
    </form>
</div>

<ul id="pm-menu-list">
    <li class="first">
      <a id="toplevellink" href="https://awesomewm.org/bugs/index.php?do=toplevel&amp;project=1">Overview</a>
    </li>

    <li>
    <a id="homelink"
        href="https://awesomewm.org/bugs/index.php?project=1&amp;do=index">Tasklist</a>
    </li>

    
    
        <li>
    <a id="roadmaplink"
        href="https://awesomewm.org/bugs/index.php?do=roadmap&amp;project=1">Roadmap</a>
    </li>
    
    
    </ul>
</div>

    
    <div id="content">
      <div id="showtask">
        <form action="https://awesomewm.org/bugs/index.php" method="get">
          <div>
            <button type="submit">Show Task #</button>
            <input id="taskid" name="show_task" class="text" type="text" size="10" accesskey="t" />
          </div>
        </form>
      </div>

      <div class="clear"></div>
            <div id="intromessage">Welcome to awesome bug tracking system.</div>
      <div id="taskdetails">
<span id="navigation">       <a href="https://awesomewm.org/bugs/index.php?project=1&amp;do=index&amp;opened=319&amp;status%5B0%5D=">Tasklist</a>
   |     <del>&#160;<a href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=535&amp;opened=319&amp;status%5B0%5D=" title="Fixed | Tab completion broken for executables in subdirectories | 100%"  id = "next" accesskey = "n" class = "closedtasklink">Next task</a>&#160;</del>  </span>

  <h2 class="summary severity2">
	 FS#699 - hiding toplevel windows is not supported  </h2>

  <div id="fineprint">
	 Attached to Project:
	 <a href="/bugs/index.php?project=1">awesome</a>
	 <br />
	 Opened by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=319">Andreas Kloeckner (inducer)</a>     	 - Tuesday, 15 December 2009, 03:12 GMT 	 	 <br />
	 Last edited by  <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=289">Uli Schlachter (psychon)</a>	 - Friday, 08 January 2010, 23:20 GMT 	   </div>

  <table><tr><td id="taskfieldscell">
  <div id="taskfields">
	 <table>
		<tr>
		  <th id="tasktype">Task Type</th>
		  <td headers="tasktype">Bug Report</td>
		</tr>
		<tr>
		  <th id="category">Category</th>
		  <td headers="category">
			 			 Core		  </td>
		</tr>
		<tr>
		  <th id="status">Status</th>
		  <td headers="status">
			 			 Closed			 		  </td>
		</tr>
		<tr>
		  <th id="assignedto">Assigned To</th>
		  <td headers="assignedto">
			 			 <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=289">Uli Schlachter (psychon)</a><br />
			 		  </td>
		</tr>
		<tr>
		  <th id="os">Operating System</th>
		  <td headers="os">All</td>
		</tr>
		<tr>
		  <th id="severity">Severity</th>
		  <td headers="severity">Low</td>
		</tr>
		<tr>
		  <th id="priority">Priority</th>
		  <td headers="priority">Normal</td>
		</tr>
		<tr>
		  <th id="reportedver">Reported Version</th>
		  <td headers="reportedver">3.4.2</td>
		</tr>
		<tr>
		  <th id="dueversion">Due in Version</th>
		  <td headers="dueversion">
			 			 Undecided			 		  </td>
		</tr>
		<tr>
		  <th id="duedate">Due Date</th>
		  <td headers="duedate">
			 Undecided		  </td>
		</tr>
		<tr>
		  <th id="percent">Percent Complete</th>
		  <td headers="percent">
			 <img src="https://awesomewm.org/bugs/themes/Bluey/percent-100.png"
				title="100% complete"
				alt="100%" />
		  </td>
		</tr>
        <tr class="votes">
		  <th id="votes">Votes</th>
		  <td headers="votes">
                    0
                              </td>
        </tr>
        <tr>
		  <th id="private">Private</th>
		  <td headers="private">
                        No            
                      </td>
        </tr>
        	 </table>
  </div>

  </td><td>

  <div id="taskdetailsfull">
	 <h3 class="taskdesc">Details</h3>
     <div id="taskdetailstext">I&#039;ve attached a ten-line PyQt demo that tries to hide its main Window.<br />
<br />
Expected result: no main window.<br />
<br />
Actual result: a garbled carcass of a window that is immovable, doesn&#039;t redraw and can&#039;t be closed.</div>

         <div class="attachments">
          <a title="bleh.py" href="?getfile=263" >
                <img src="https://awesomewm.org/bugs/themes/Bluey/mime/text.png" alt="" title="text/plain" />
            &nbsp;&nbsp;
            bleh.py
                  </a>
                  (0.1 KiB)
          <br />
    </div>
  
  </div>

  </td></tr></table>

  <div id="taskinfo">
	 <div id="taskdeps">
		<b>This task depends upon</b>
		<br />
		
		<br class="DoNotPrint" />

		
			 </div>

	 <div id="taskblocks">
        			 </div>
  </div>

    <div id="taskclosed">
      Closed by&nbsp;&nbsp;<a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=289">Uli Schlachter (psychon)</a><br />
      Friday, 08 January 2010, 23:20 GMT <br />
      <strong>Reason for closing:</strong> &nbsp;Fixed<br />
            <strong>Additional comments about closing:</strong> &nbsp;commit
026247cf181c88a3331275ce7e40b30d1cbd2591
<br />
Author: Uli Schlachter
&lt;psychon@znc.in&gt;<br />
Date:   Mon Dec 28 19:26:00 2009
+0100<br />
<br />
    Handle synthetic UnmapNotify events
*correctly*<br />
    <br />
    Second try:<br />
    <br />
    Turns out I messed up with
XCB_EVENT_SENT() and had a &quot;!&quot;
too much. The old code<br />
    already tried to cope with this, but
forgot to actually unmap the window
which<br />
    it just set to withdrawn state.<br
/>
    <br />
    This time I tested the patch *again*
and now I found even less bugs than on
my<br />
    last try.<br />
    <br />
    P.S.: I suck.<br />
    <br />
    Signed-off-by: Uli Schlachter
&lt;psychon@znc.in&gt;<br />
    Signed-off-by: Julien Danjou
&lt;julien@danjou.info&gt;        </div>
  
  <div id="actionbuttons">
	 
	 
	 	   </div>
</div>
<ul id="submenu">
    <li id="commentstab">
  <a href="#comments">Comments (20)</a>
  </li>
  
  <li id="relatedtab">
  <a href="#related">Related Tasks (0/0)</a>
  </li>

  
  </ul>
<div id="comments" class="tab">
    <em>
    <a name="comment1610" id="comment1610"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=699#comment1610">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=289">Uli Schlachter (psychon)</a> -
    Tuesday, 15 December 2009, 20:06 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">No idea what QT is smoking, but I want some.<br />
<br />
I started a new X server without any window manager (Xephyr to be exact) and ran this app under xtrace (had to install a shitload of python stuff for this :( ).<br />
QT creates 6 (!!!!) windows (I skipped everything except CreateWindow, MapWindow, UnmapWindow and ConfigureWindow here):<br />
<br />
000:&lt;:0075: 40: Request(1): CreateWindow depth=0x00 window=0x00200001 parent=0x0000010b x=375 y=300 width=750 height=400 border-width=0 class=CopyFromParent(0x0000) visual=CopyFromParent(0x00000000) value-list={background-pixel=0xff000000 border-pixel=0xff000000}<br />
000:&lt;:0076: 40: Request(1): CreateWindow depth=0x00 window=0x00200002 parent=0x0000010b x=0 y=0 width=1 height=1 border-width=0 class=CopyFromParent(0x0000) visual=CopyFromParent(0x00000000) value-list={background-pixel=0x00000000 border-pixel=0x00000000}<br />
000:&lt;:007e: 20: Request(12): ConfigureWindow window=0x00200001 values={width=750 height=400}<br />
000:&lt;:0089: 16: Request(2): ChangeWindowAttributes window=0x00200001 value-list={bit-gravity=NorthWest(0x01)}<br />
000:&lt;:008a: 16: Request(2): ChangeWindowAttributes window=0x00200001 value-list={event-mask=KeyPress,KeyRelease,ButtonPress,ButtonRelease,EnterWindow,LeaveWindow,ButtonMotion,KeymapState,Exposure,StructureNotify,FocusChange,PropertyChange}<br />
000:&lt;:008d: 16: Request(2): ChangeWindowAttributes window=0x00200001 value-list={cursor=0x00200005}<br />
000:&lt;:008e: 16: Request(2): ChangeWindowAttributes window=0x00200001 value-list={background-pixel=0xff6a756e}<br />
000:&lt;:008f: 40: Request(1): CreateWindow depth=0x00 window=0x00200006 parent=0x00200001 x=0 y=0 width=100 height=30 border-width=0 class=CopyFromParent(0x0000) visual=CopyFromParent(0x00000000) value-list={background-pixel=0xff000000 border-pixel=0xff000000}<br />
000:&lt;:0090: 16: Request(2): ChangeWindowAttributes window=0x00200006 value-list={bit-gravity=NorthWest(0x01)}<br />
000:&lt;:0091: 16: Request(2): ChangeWindowAttributes window=0x00200006 value-list={event-mask=KeyPress,KeyRelease,ButtonPress,ButtonRelease,EnterWindow,LeaveWindow,ButtonMotion,KeymapState,Exposure,StructureNotify,FocusChange,PropertyChange}<br />
000:&lt;:0092: 16: Request(2): ChangeWindowAttributes window=0x00200006 value-list={background-pixel=0xff6a756e}<br />
000:&lt;:0093: 40: Request(1): CreateWindow depth=0x00 window=0x00200007 parent=0x00200001 x=0 y=0 width=100 height=30 border-width=0 class=CopyFromParent(0x0000) visual=CopyFromParent(0x00000000) value-list={background-pixel=0xff000000 border-pixel=0xff000000}<br />
000:&lt;:0094: 16: Request(2): ChangeWindowAttributes window=0x00200007 value-list={bit-gravity=NorthWest(0x01)}<br />
000:&lt;:0095: 16: Request(2): ChangeWindowAttributes window=0x00200007 value-list={event-mask=KeyPress,KeyRelease,ButtonPress,ButtonRelease,EnterWindow,LeaveWindow,ButtonMotion,KeymapState,Exposure,StructureNotify,FocusChange,PropertyChange}<br />
000:&lt;:0096: 16: Request(2): ChangeWindowAttributes window=0x00200007 value-list={background-pixel=0xff6a756e}<br />
000:&lt;:0097: 40: Request(1): CreateWindow depth=0x00 window=0x00200008 parent=0x00200001 x=0 y=0 width=100 height=30 border-width=0 class=CopyFromParent(0x0000) visual=CopyFromParent(0x00000000) value-list={background-pixel=0xff000000 border-pixel=0xff000000}<br />
000:&lt;:0098: 16: Request(2): ChangeWindowAttributes window=0x00200008 value-list={bit-gravity=NorthWest(0x01)}<br />
000:&lt;:0099: 16: Request(2): ChangeWindowAttributes window=0x00200008 value-list={event-mask=KeyPress,KeyRelease,ButtonPress,ButtonRelease,EnterWindow,LeaveWindow,ButtonMotion,KeymapState,Exposure,StructureNotify,FocusChange,PropertyChange}<br />
000:&lt;:009a: 16: Request(2): ChangeWindowAttributes window=0x00200008 value-list={background-pixel=0xff6a756e}<br />
000:&lt;:009b: 40: Request(1): CreateWindow depth=0x00 window=0x00200009 parent=0x00200001 x=0 y=0 width=100 height=30 border-width=0 class=CopyFromParent(0x0000) visual=CopyFromParent(0x00000000) value-list={background-pixel=0xff000000 border-pixel=0xff000000}<br />
000:&lt;:009c: 16: Request(2): ChangeWindowAttributes window=0x00200009 value-list={bit-gravity=NorthWest(0x01)}<br />
000:&lt;:009d: 16: Request(2): ChangeWindowAttributes window=0x00200009 value-list={event-mask=KeyPress,KeyRelease,ButtonPress,ButtonRelease,EnterWindow,LeaveWindow,ButtonMotion,KeymapState,Exposure,StructureNotify,FocusChange,PropertyChange}<br />
000:&lt;:009e: 16: Request(2): ChangeWindowAttributes window=0x00200009 value-list={background-pixel=0xff6a756e}<br />
000:&lt;:009f: 40: Request(1): CreateWindow depth=0x00 window=0x0020000a parent=0x00200001 x=0 y=0 width=100 height=30 border-width=0 class=CopyFromParent(0x0000) visual=CopyFromParent(0x00000000) value-list={background-pixel=0xff000000 border-pixel=0xff000000}<br />
000:&lt;:00a0: 16: Request(2): ChangeWindowAttributes window=0x0020000a value-list={bit-gravity=NorthWest(0x01)}<br />
000:&lt;:00a1: 16: Request(2): ChangeWindowAttributes window=0x0020000a value-list={event-mask=KeyPress,KeyRelease,ButtonPress,ButtonRelease,EnterWindow,LeaveWindow,ButtonMotion,KeymapState,Exposure,StructureNotify,FocusChange,PropertyChange}<br />
000:&lt;:00a2: 16: Request(2): ChangeWindowAttributes window=0x0020000a value-list={background-pixel=0xff6a756e}<br />
000:&lt;:00a3:  8: Request(10): UnmapWindow window=0x0020000a<br />
000:&lt;:00a4: 20: Request(12): ConfigureWindow window=0x0020000a values={width=100 height=11}<br />
000:&lt;:00a5: 16: Request(2): ChangeWindowAttributes window=0x0020000a value-list={event-mask=KeyPress,KeyRelease,ButtonPress,ButtonRelease,EnterWindow,LeaveWindow,PointerMotion,ButtonMotion,KeymapState,Exposure,StructureNotify,FocusChange,PropertyChange}<br />
000:&lt;:00a6: 16: Request(2): ChangeWindowAttributes window=0x0000010b value-list={event-mask=EnterWindow,LeaveWindow,KeymapState,PropertyChange}<br />
000:&gt;:00a6: Event ConfigureNotify(22) event=0x0020000a window=0x0020000a above-sibling=0x00200009 x=0 y=0 width=100 height=11 border-width=0 override-redirect=false(0x00)<br />
000:&lt;:00a7: 16: Request(2): ChangeWindowAttributes window=0x00200001 value-list={event-mask=KeyPress,KeyRelease,ButtonPress,ButtonRelease,EnterWindow,LeaveWindow,PointerMotion,ButtonMotion,KeymapState,Exposure,StructureNotify,FocusChange,PropertyChange}<br />
000:&lt;:00a8: 16: Request(2): ChangeWindowAttributes window=0x00200006 value-list={event-mask=KeyPress,KeyRelease,ButtonPress,ButtonRelease,EnterWindow,LeaveWindow,PointerMotion,ButtonMotion,KeymapState,Exposure,StructureNotify,FocusChange,PropertyChange}<br />
000:&lt;:00a9: 16: Request(2): ChangeWindowAttributes window=0x00200007 value-list={event-mask=KeyPress,KeyRelease,ButtonPress,ButtonRelease,EnterWindow,LeaveWindow,PointerMotion,ButtonMotion,KeymapState,Exposure,StructureNotify,FocusChange,PropertyChange}<br />
000:&lt;:00aa: 16: Request(2): ChangeWindowAttributes window=0x00200008 value-list={event-mask=KeyPress,KeyRelease,ButtonPress,ButtonRelease,EnterWindow,LeaveWindow,PointerMotion,ButtonMotion,KeymapState,Exposure,StructureNotify,FocusChange,PropertyChange}<br />
000:&lt;:00ab: 16: Request(2): ChangeWindowAttributes window=0x00200009 value-list={event-mask=KeyPress,KeyRelease,ButtonPress,ButtonRelease,EnterWindow,LeaveWindow,PointerMotion,ButtonMotion,KeymapState,Exposure,StructureNotify,FocusChange,PropertyChange}<br />
000:&lt;:00ac: 96: Request(18): ChangeProperty mode=Replace(0x00) window=0x00200001 property=0x28(&quot;WM_NORMAL_HINTS&quot;) type=0x29(&quot;WM_SIZE_HINTS&quot;) data=0x0000020a,0x00000000,0x00000000,0x000000c8,0x00000096,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000001;<br />
000:&lt;:00ad: 20: Request(12): ConfigureWindow window=0x00200001 values={width=200 height=150}<br />
000:&lt;:00ae: 28: Request(12): ConfigureWindow window=0x00200006 values={x=0 y=0 width=200 height=1}<br />
000:&lt;:00af: 28: Request(12): ConfigureWindow window=0x00200008 values={x=0 y=1 width=1 height=148}<br />
000:&lt;:00b0: 28: Request(12): ConfigureWindow window=0x00200009 values={x=200 y=1 width=1 height=148}<br />
000:&lt;:00b1: 28: Request(12): ConfigureWindow window=0x00200007 values={x=0 y=149 width=200 height=1}<br />
000:&lt;:00b3:  8: Request(8): MapWindow window=0x00200006<br />
000:&lt;:00b4:  8: Request(8): MapWindow window=0x00200007<br />
000:&lt;:00b5:  8: Request(8): MapWindow window=0x00200008<br />
000:&lt;:00b6:  8: Request(8): MapWindow window=0x00200009<br />
000:&lt;:00b9:  8: Request(8): MapWindow window=0x00200001<br />
000:&lt;:00ba:  8: Request(10): UnmapWindow window=0x00200001<br />
<br />
(One window made invisible which never was visible in the first place, then 5 other windows made visible and one hidden again)</div></div>

  
    <em>
    <a name="comment1612" id="comment1612"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=699#comment1612">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=289">Uli Schlachter (psychon)</a> -
    Tuesday, 15 December 2009, 20:36 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">I made a c++ version of this, bug happens here too.</div></div>

      <div class="attachments">
          <a title="t.cpp" href="?getfile=264" >
                <img src="https://awesomewm.org/bugs/themes/Bluey/mime/text.png" alt="" title="text/plain" />
            &nbsp;&nbsp;
            t.cpp
                  </a>
                  (0.2 KiB)
          <br />
    </div>
  

    <em>
    <a name="comment1618" id="comment1618"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=699#comment1618">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=84">anrxc (anrxc)</a> -
    Thursday, 17 December 2009, 21:56 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">PyQT4 version attached below. I lost all input control in awesome, had to switch to the console to kill the window. Run in twm after that as requested by psychon and there window is movable, input is active, and window can be killed.<br /></div></div>

      <div class="attachments">
          <a title="bleh-pyqt4.py" href="?getfile=265" >
                <img src="https://awesomewm.org/bugs/themes/Bluey/mime/text.png" alt="" title="text/plain" />
            &nbsp;&nbsp;
            bleh-pyqt4.py
                  </a>
                  (0.1 KiB)
          <br />
    </div>
  

    <em>
    <a name="comment1619" id="comment1619"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=699#comment1619">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=319">Andreas Kloeckner (inducer)</a> -
    Thursday, 17 December 2009, 22:14 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">Btw, this is not just an academic exercise. This occurs in real life when using the program VisIt, see<a href=" https://wci.llnl.gov/codes/visit/"> https://wci.llnl.gov/codes/visit/</a>.</div></div>

  
    <em>
    <a name="comment1622" id="comment1622"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=699#comment1622">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=289">Uli Schlachter (psychon)</a> -
    Friday, 18 December 2009, 18:44 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">I wrote yet another test app. This one waits 10 sec, then shows the window, waits another 10 sec to hide it and after 10 more seconds the app exits.<br />
Bug does not happen here. I feel like blaming Qt....</div></div>

      <div class="attachments">
          <a title="t.cpp" href="?getfile=266" >
                <img src="https://awesomewm.org/bugs/themes/Bluey/mime/text.png" alt="" title="text/plain" />
            &nbsp;&nbsp;
            t.cpp
                  </a>
                  (0.3 KiB)
          <br />
    </div>
  

    <em>
    <a name="comment1623" id="comment1623"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=699#comment1623">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=319">Andreas Kloeckner (inducer)</a> -
    Friday, 18 December 2009, 19:18 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">I doubt it&#039;s Qt&#039;s fault. Even in your first trace, there&#039;s an UnmapWindow at the end, however the window clearly doesn&#039;t get unmapped.</div></div>

  
    <em>
    <a name="comment1659" id="comment1659"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=699#comment1659">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=289">Uli Schlachter (psychon)</a> -
    Tuesday, 22 December 2009, 13:23 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">I downloaded a vanilla dwm, compiled it and started it in Xephyr.<br />
Both .cpp test apps show the exact same behavior in dwm as they do in awesome.<br />
<br />
@inducer: Well, there are 2 UnmapWindow (technically only one) and 5 MapWindow. That leaves us with at least 3 windows still being mapped.</div></div>

  
    <em>
    <a name="comment1661" id="comment1661"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=699#comment1661">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=289">Uli Schlachter (psychon)</a> -
    Tuesday, 22 December 2009, 13:32 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">I just had an idea: Could this be a race condition?<br />
<br />
- Qt&#039;s show() is called, it sends a MapWindow command.<br />
- Immediately afterwards, hide() is called and a UnmapWindow is sent.<br />
- The X server sees the MapWindow request, but because a WM is running, it sends a MapRequest to the WM and doesn&#039;t do anything else.<br />
- The X server receives an UnmapWindow command, but since the window isn&#039;t mapped yet, this command does nothing.<br />
- The WM gets the MapRequest and thus maps the window (MapWindow again).<br />
<br />
Because the UnmapWindow was discarded, the window stays visible.<br />
<br />
Thoughts?  Does this sound realistic? Why doesn&#039;t this happen with other WMs? (Anybody can test *if* this happens with other WMs?)<br />
<br />
This would also explain why my second .cpp file doesn&#039;t cause this bug to happen.</div></div>

  
    <em>
    <a name="comment1662" id="comment1662"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=699#comment1662">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=1">Julien Danjou (jd)</a> -
    Tuesday, 22 December 2009, 13:37 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">Sounds realistic. We probably miss a couple of xcb_{un,}grab_server() in the manage/unmanage function.</div></div>

  
    <em>
    <a name="comment1663" id="comment1663"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=699#comment1663">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=289">Uli Schlachter (psychon)</a> -
    Tuesday, 22 December 2009, 13:49 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">I don&#039;t think we can do much about this. If my guess really is the case, by the time we receive the MapRequest, lots of things could already have happened. I&#039;ll try to find out why this doesnt happen with other WMs.<br />
Suggestions for a lightweight WM to test with?</div></div>

  
    <em>
    <a name="comment1664" id="comment1664"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=699#comment1664">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=1">Julien Danjou (jd)</a> -
    Tuesday, 22 December 2009, 13:54 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">evilwm, dwm, wmaker?</div></div>

  
    <em>
    <a name="comment1667" id="comment1667"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=699#comment1667">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=289">Uli Schlachter (psychon)</a> -
    Tuesday, 22 December 2009, 14:15 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">dwm: As mentioned above, bug happens here, too.<br />
<br />
evilwm: Bug happens, too.<br />
evilwm receives a MapRequest and then a generated UnmapNotify (wtf? what is Qt doing?). It reparents and maps Qt&#039;s window and then maps its own frame-window.<br />
<br />
wmaker: bug *does* *not* happen. No idea why yet.<br />
I&#039;ll investigate.</div></div>

  
    <em>
    <a name="comment1669" id="comment1669"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=699#comment1669">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=289">Uli Schlachter (psychon)</a> -
    Tuesday, 22 December 2009, 14:50 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">Hm, no idea what wmaker does differently. The Qt test app (client 004 in the attached trace) sends a MapWindow and a UnmapWindow at 1261491545.483 sequence 00bd and 1261491545.484 sequence 00c5.<br />
For some reason that I don&#039;t understand, wmaker (client 000) then later unmaps the test window at 1261491545.502 sequence 3e05.<br />
<br />
There are 859 lines of output between these two events. :(<br />
<br />
*But* there is still a weird icon in wmaker&#039;s weird-icon-area (No idea what that&#039;s supposed to be, but there is one icon per open client (I had some xterm running)</div></div>

      <div class="attachments">
          <a title="trace" href="?getfile=277" >
                <img src="https://awesomewm.org/bugs/themes/Bluey/mime/text.png" alt="" title="text/plain" />
            &nbsp;&nbsp;
            trace
                  </a>
                  (184.7 KiB)
          <br />
    </div>
  

    <em>
    <a name="comment1670" id="comment1670"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=699#comment1670">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=319">Andreas Kloeckner (inducer)</a> -
    Tuesday, 22 December 2009, 15:09 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">Metacity and kwin are also both fine.</div></div>

  
    <em>
    <a name="comment1671" id="comment1671"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=699#comment1671">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=1">Julien Danjou (jd)</a> -
    Tuesday, 22 December 2009, 15:23 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">Actually, I think taking a look on when wmaker does grab and ungrab the server and mimicking it may be enough to have a fix.</div></div>

  
    <em>
    <a name="comment1672" id="comment1672"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=699#comment1672">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=289">Uli Schlachter (psychon)</a> -
    Tuesday, 22 December 2009, 20:22 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">I looked at wmaker&#039;s source and I think I figured it out.<br />
At 1261491545.484 000:&gt;:3b83: receives a *generated* UnmapNotify. Due to this, it sets the window&#039;s state to withdrawn, unmaps it etc.<br />
<br />
awesome, on the hand, end up in event_handle_unmapnotify(). Here, generated events are just plainly ignored. Also, I&#039;m not sure if awesome (tries to) unmap a window in respsonse to an UnmapNotify....<br />
<br />
(No idea how much of this is intended, it might be that wmaker just does this accidentally; I think next I&#039;ll take a look at Qt&#039;s source, oh joy...)</div></div>

  
    <em>
    <a name="comment1673" id="comment1673"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=699#comment1673">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=289">Uli Schlachter (psychon)</a> -
    Tuesday, 22 December 2009, 20:47 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">Hm, ok, here&#039;s the qt side of things:<br />
<br />
src/gui/kernel/qwidget_x11.cpp, QWidgetPrivate::hide_sys() calls XWithdrawWindow() which unmaps the window and sends the synthetic UnmapNotify to the WM.<br />
I guess most WMs unmap a window when they receive a synthetic UnmapNotify?</div></div>

  
    <em>
    <a name="comment1674" id="comment1674"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=699#comment1674">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=289">Uli Schlachter (psychon)</a> -
    Tuesday, 22 December 2009, 21:07 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">Ok, from XWithdrawWindow() I googled my way through its man page until I reached the ICCCM (InterClient Communication Conventions Manual). Chapter 4 is &quot;Client-to-Window-Manage Communication&quot;. Chapter 4.1.4 explains &quot;Changing Window State&quot;.<br />
For Normal to Withdrawn state, one can read:<br />
<br />
Normal ? Withdrawn ? The client should unmap the window and follow it with a synthetic UnmapNotify event as described later in this section.<br />
<br />
And later:<br />
<br />
Advice to Implementors<br />
For compatibility with obsolete clients, window managers should trigger the transi-<br />
tion to the Withdrawn state on the real UnmapNotify rather than waiting for the syn-<br />
thetic one. They should also trigger the transition if they receive a synthetic Unmap-<br />
Notify on a window for which they have not yet received a real UnmapNotify.<br />
<br />
So ICCCM mandates that we unmap windows when we receive a synthetic UnmapNotify on the root window. This is something we aren&#039;t doing currently.<br />
<br />
So this really is a bug in awesome (and evilwm, dwm, ....).</div></div>

  
    <em>
    <a name="comment1681" id="comment1681"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=699#comment1681">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=319">Andreas Kloeckner (inducer)</a> -
    Wednesday, 23 December 2009, 17:29 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">Thanks very much for taking the time to track this down!<br />
<br />
Andreas</div></div>

  
    <em>
    <a name="comment1695" id="comment1695"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=699#comment1695">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=289">Uli Schlachter (psychon)</a> -
    Monday, 28 December 2009, 19:06 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">Ok, I&#039;m a little confused on a way to go here. My latest commit (which sadly was already merged) definitely is buggy and has to be removed ASAP (@jd: Feel free to revert).<br />
<br />
To fix this bug we have to xcb_unmap_window() in the UnmapNotify handle right after calling client_unmanage(). But we should also trigger the switch to withdrawn state if a client just unmaps one of its windows according to ICCCM (this should also fix some other bugs where windows still show up on the tasklist even though they shouldn&#039;t).<br />
<br />
The first part is easy: As I said, just add a call to xcb_unmap_window() (I verified this to actually work).<br />
This last part is where it&#039;s getting tricky. We have to client_unmanage() on a real UnmapNotify. But not if this event is from awesome, else we lose clients on tag switch (this is where my first patch failed badly, oh and I fucked up an if).<br />
<br />
So how do we find out if it was awesome who generated the unmap or a client? If we just ignored real unmap notifies as we did before, how many apps would break?</div></div>

  
  
  </div>
<div id="related" class="tab">
  <table>    <tr><td>
    <form method="post" action="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=699#related" >
        <table id="tasks_related" class="userlist">
        <tr>
          <th>
            <a href="javascript:ToggleSelected('tasks_related')">
              <img title="Toggle Selected" alt="Toggle Selected" src="https://awesomewm.org/bugs/themes/Bluey/kaboodleloop.png" width="16" height="16" />
            </a>
          </th>
          <th>Tasks related to this task (0)</th>
        </tr>
                <tr>
          <td colspan="2">
            <input type="hidden" name="action" value="remove_related" />
            <input type="hidden" name="task_id" value="699" />
            <button type="submit">Remove</button>
          </td>
        </tr>
        </table>
    </form>
    </td><td>
    
    <table id="duplicate_tasks" class="userlist">
        <tr>
          <th>Duplicate tasks of this task (0)</th>
        </tr>
            </table>
    </td></tr>
  </table>

  </div>
<div id="history" class="tab">
  <h3>Loading...</h3>
</div>
    </div>
    <p id="footer">
       <!-- Please don't remove this line - it helps promote Flyspray -->
       <a href="http://flyspray.org/" class="offsite">Powered by Flyspray</a>
    </p>
  </div>
  </body>
</html>
