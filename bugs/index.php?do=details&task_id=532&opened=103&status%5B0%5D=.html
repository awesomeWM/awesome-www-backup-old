<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-AU" xml:lang="en-AU">
  <head>
    <title>FS#532 : History is broken</title>

    <meta name="description" content="Flyspray, a Bug Tracking System written in PHP." />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Script-Type" content="text/javascript" />
    <meta http-equiv="Content-Style-Type" content="text/css" />

    <link rel="icon" type="image/png" href="https://awesomewm.org/bugs/themes/Bluey/favicon.ico" />
    <link rel="index" id="indexlink" type="text/html" href="https://awesomewm.org/bugs/" />
        <link media="screen" href="https://awesomewm.org/bugs/themes/Bluey/theme.css" rel="stylesheet" type="text/css" />
    <link media="print"  href="https://awesomewm.org/bugs/themes/Bluey/theme_print.css" rel="stylesheet" type="text/css" />
    <link rel="alternate" type="application/rss+xml" title="Flyspray RSS 1.0 Feed"
          href="https://awesomewm.org/bugs/feed.php?feed_type=rss1&amp;project=1" />
    <link rel="alternate" type="application/rss+xml" title="Flyspray RSS 2.0 Feed"
          href="https://awesomewm.org/bugs/feed.php?feed_type=rss2&amp;project=1" />
	<link rel="alternate" type="application/atom+xml" title="Flyspray Atom 0.3 Feed"
	      href="https://awesomewm.org/bugs/feed.php?feed_type=atom&amp;project=1" />

    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/prototype/prototype.js"></script>
    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/script.aculo.us/scriptaculous.js"></script>
            <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/details.js"></script>
                <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/tabs.js"></script>
    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/functions.js"></script>
    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/jscalendar/calendar_stripped.js"></script>
    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/jscalendar/calendar-setup_stripped.js"> </script>
    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/jscalendar/lang/calendar-en.js"></script>
    <script type="text/javascript" src="https://awesomewm.org/bugs/javascript/lightbox/js/lightbox.js"></script>
    <link rel="stylesheet" href="https://awesomewm.org/bugs/javascript/lightbox/css/lightbox.css" type="text/css" media="screen" />
    <!--[if IE]>
    <link media="screen" href="https://awesomewm.org/bugs/themes/Bluey/ie.css" rel="stylesheet" type="text/css" />
    <![endif]-->
      </head>
  <body onload="perms = new Perms('permissions');">

  <div id="container">
    <!-- Remove this to remove the logo -->
    <h1 id="title"><a href="https://awesomewm.org/bugs/">awesome</a></h1>

    <div id="menu">

<form id="login" action="https://awesomewm.org/bugs/index.php?do=authenticate" method="post">
<div>
  <label for="lbl_user_name">Username</label>
  <input class="text" type="text" id="lbl_user_name" name="user_name" size="17" maxlength="30" />

  <label for="lbl_password">Password</label>
  <input class="password" type="password" id="lbl_password" name="password" size="17" maxlength="30" />

  <label for="lbl_remember">Remember me</label>
  <input type="checkbox" id="lbl_remember" name="remember_login" />
  
  <input type="hidden" name="return_to" value="/bugs/index.php?do=details&amp;task_id=532&amp;opened=103&amp;status%5B0%5D=" />

  <button accesskey="l" type="submit">Login!</button>

  <span id="links">
            <a id="forgotlink" href="https://awesomewm.org/bugs/index.php?do=lostpw">Lost password?</a>
      </span>
</div>
</form>
</div>

<div id="pm-menu">

<div id="projectselector">
    <form id="projectselectorform" action="https://awesomewm.org/bugs/index.php" method="get">
       <div>
        <select name="project" onChange="document.getElementById('projectselectorform').submit()">
          <option value="0">All Projects</option>        </select>
        <button type="submit">Switch</button>
        <input type="hidden" name="do" value="details" />
        <input type="hidden" value="1" name="switch" />
              </div>
    </form>
</div>

<ul id="pm-menu-list">
    <li class="first">
      <a id="toplevellink" href="https://awesomewm.org/bugs/index.php?do=toplevel&amp;project=1">Overview</a>
    </li>

    <li>
    <a id="homelink"
        href="https://awesomewm.org/bugs/index.php?project=1&amp;do=index">Tasklist</a>
    </li>

    
    
        <li>
    <a id="roadmaplink"
        href="https://awesomewm.org/bugs/index.php?do=roadmap&amp;project=1">Roadmap</a>
    </li>
    
    
    </ul>
</div>

    
    <div id="content">
      <div id="showtask">
        <form action="https://awesomewm.org/bugs/index.php" method="get">
          <div>
            <button type="submit">Show Task #</button>
            <input id="taskid" name="show_task" class="text" type="text" size="10" accesskey="t" />
          </div>
        </form>
      </div>

      <div class="clear"></div>
            <div id="intromessage">Welcome to awesome bug tracking system.</div>
      <div id="taskdetails">
<span id="navigation">   <del>&#160;<a href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=674&amp;opened=103&amp;status%5B0%5D=" title="Fixed | History tag switching incorrect behavior | 100%"  id = "prev" accesskey = "p" class = "closedtasklink">Previous task</a>&#160;</del>     |     <a href="https://awesomewm.org/bugs/index.php?project=1&amp;do=index&amp;opened=103&amp;status%5B0%5D=">Tasklist</a>
   |     <del>&#160;<a href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=505&amp;opened=103&amp;status%5B0%5D=" title="Not a bug | NumLock On disables awesome interaction | 100%"  id = "next" accesskey = "n" class = "closedtasklink">Next task</a>&#160;</del>  </span>

  <h2 class="summary severity3">
	 FS#532 - History is broken  </h2>

  <div id="fineprint">
	 Attached to Project:
	 <a href="/bugs/index.php?project=1">awesome</a>
	 <br />
	 Opened by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=103">Félix C. Morency (flx)</a>     	 - Saturday, 13 June 2009, 01:27 GMT 	 	 <br />
	 Last edited by  <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=1">Julien Danjou (jd)</a>	 - Monday, 31 August 2009, 08:45 GMT 	   </div>

  <table><tr><td id="taskfieldscell">
  <div id="taskfields">
	 <table>
		<tr>
		  <th id="tasktype">Task Type</th>
		  <td headers="tasktype">Bug Report</td>
		</tr>
		<tr>
		  <th id="category">Category</th>
		  <td headers="category">
			 			 Lua libraries &#8594;
			 			 awful		  </td>
		</tr>
		<tr>
		  <th id="status">Status</th>
		  <td headers="status">
			 			 Closed			 		  </td>
		</tr>
		<tr>
		  <th id="assignedto">Assigned To</th>
		  <td headers="assignedto">
			 			 No-one			 		  </td>
		</tr>
		<tr>
		  <th id="os">Operating System</th>
		  <td headers="os">Linux</td>
		</tr>
		<tr>
		  <th id="severity">Severity</th>
		  <td headers="severity">Medium</td>
		</tr>
		<tr>
		  <th id="priority">Priority</th>
		  <td headers="priority">Normal</td>
		</tr>
		<tr>
		  <th id="reportedver">Reported Version</th>
		  <td headers="reportedver">git/master</td>
		</tr>
		<tr>
		  <th id="dueversion">Due in Version</th>
		  <td headers="dueversion">
			 			 3.4			 		  </td>
		</tr>
		<tr>
		  <th id="duedate">Due Date</th>
		  <td headers="duedate">
			 Undecided		  </td>
		</tr>
		<tr>
		  <th id="percent">Percent Complete</th>
		  <td headers="percent">
			 <img src="https://awesomewm.org/bugs/themes/Bluey/percent-100.png"
				title="100% complete"
				alt="100%" />
		  </td>
		</tr>
        <tr class="votes">
		  <th id="votes">Votes</th>
		  <td headers="votes">
                    <a href="javascript:showhidestuff('showvotes')">4 </a>
          <div id="showvotes" class="hide">
              <ul class="reports">
                              <li><a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=333">kba (kba)</a> (2009-07-12)</li>
                              <li><a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=126">py rho (pyrho)</a> (2009-07-05)</li>
                              <li><a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=190">koniu (koniu)</a> (2009-06-27)</li>
                              <li><a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=140">Konstantin Stepanov (kstep)</a> (2009-06-26)</li>
                            </ul>
          </div>
                              </td>
        </tr>
        <tr>
		  <th id="private">Private</th>
		  <td headers="private">
                        No            
                      </td>
        </tr>
        	 </table>
  </div>

  </td><td>

  <div id="taskdetailsfull">
	 <h3 class="taskdesc">Details</h3>
     <div id="taskdetailstext">Navigate from tag #1 to tag #2. Try switching back to previous tag with Mod4-Escape. Notice it goes to another &quot;unexisting&quot; tag.<br />
<br />
awesome v3.3-79-g1fe239e (Stellar)<br />
 • Build: Jun 12 2009 21:23:26 for i686 by gcc version 4.4.0 (felix@felix-laptop)<br />
 • D-Bus support: ?<br />
<br />
Linux felix-laptop 2.6.29-ARCH #1 SMP PREEMPT Wed May 20 07:06:02 UTC 2009 i686 Intel(R) Pentium(R) M processor 1.73GHz GenuineIntel GNU/Linux</div>

       
  </div>

  </td></tr></table>

  <div id="taskinfo">
	 <div id="taskdeps">
		<b>This task depends upon</b>
		<br />
		
		<br class="DoNotPrint" />

		
			 </div>

	 <div id="taskblocks">
        			 </div>
  </div>

    <div id="taskclosed">
      Closed by&nbsp;&nbsp;<a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=1">Julien Danjou (jd)</a><br />
      Monday, 31 August 2009, 08:45 GMT <br />
      <strong>Reason for closing:</strong> &nbsp;Fixed<br />
            <strong>Additional comments about closing:</strong> &nbsp;commit
529502ffbf9c99bd8cdf0c819610651f652db31d
<br />
Author: koniu
&lt;gkusnierz@gmail.com&gt;<br />
Date:   Thu Aug 27 15:03:45 2009
+0100<br />
<br />
    awful.tag: fix and improve tag
history<br />
    <br />
    This fixes a long standing tag
history breakage. To store history<br
/>
    of tag switching we rely on a
special signal
&quot;tag::history::update&quot;<br />
    which needs to be emitted by any
function which deals with tag<br />
    selection.<br />
    <br />
    History is multi-level with a
configurable limit:<br />
    awful.tag.history.limit = 20 (by
default).<br />
    <br />
    awful.tag.history.restore function
gets a new argument &#039;idx&#039;
which can<br />
    be either &#039;previous&#039;
(default) which will revert to the
previously<br />
    selected set of tags, or a numerical
index in the tag history table.<br />
    <br />
    Signed-off-by: koniu
&lt;gkusnierz@gmail.com&gt;<br />
    Signed-off-by: Julien Danjou
&lt;julien@danjou.info&gt;<br />        </div>
  
  <div id="actionbuttons">
	 
	 
	 	   </div>
</div>
<ul id="submenu">
    <li id="commentstab">
  <a href="#comments">Comments (5)</a>
  </li>
  
  <li id="relatedtab">
  <a href="#related">Related Tasks (0/0)</a>
  </li>

  
  </ul>
<div id="comments" class="tab">
    <em>
    <a name="comment1287" id="comment1287"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=532#comment1287">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=264">Andreas Hübner (Andreas Huebner)</a> -
    Saturday, 27 June 2009, 16:48 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">Debugged this recently.<br />
<br />
There are two different problems:<br />
1. When you &quot;go&quot; from one tag to another, awesome first unselects the old tag and then selects the new tag. The history.update hook is called for both actions, which leads to data.history.past being a table with no tags selected. (all false)<br />
I did a dirty hack and skipped the update when no tag is selected by adding &quot;if selected(screen) == nil then return end&quot; at the start of the hook.<br />
<br />
2. The history.restore function itself &quot;pollutes&quot; the data.history.past table it is using. Setting t.selected triggers the history.update hook.<br />
Another dirty hack: Made a copy of the table in history.restore and used that instead.</div></div>

  
    <em>
    <a name="comment1288" id="comment1288"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=532#comment1288">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=190">koniu (koniu)</a> -
    Saturday, 27 June 2009, 17:45 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">reported a month ago :P<br />
<br /><a href="
http://www.mail-archive.com/<a href="mailto:awesome-devel@naquadah.org">awesome-devel@naquadah.org</a>/msg02532.html">
http://www.mail-archive.com/<a href="mailto:awesome-devel@naquadah.org">awesome-devel@naquadah.org</a>/msg02532.html</a></div></div>

  
    <em>
    <a name="comment1289" id="comment1289"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=532#comment1289">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=264">Andreas Hübner (Andreas Huebner)</a> -
    Saturday, 27 June 2009, 19:47 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">Sorry, I&#039;m not on the devel list. :)</div></div>

  
    <em>
    <a name="comment1301" id="comment1301"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=532#comment1301">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=200">Gregor Best (farhaven)</a> -
    Saturday, 18 July 2009, 00:05 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">Andreas: Could you provide a patch for what you did? I&#039;d like to try and maybe improve (i.e. unhack) it :)</div></div>

  
    <em>
    <a name="comment1302" id="comment1302"
      href="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=532#comment1302">
      <img src="https://awesomewm.org/bugs/themes/Bluey/comment.png"
        title="Link to this comment" alt="" />
    </a>
    Comment by <a href="https://awesomewm.org/bugs/index.php?do=user&amp;area=users&amp;id=190">koniu (koniu)</a> -
    Saturday, 18 July 2009, 03:09 GMT   </em>

  <span class="DoNotPrint">
    
      </span>
  <div class="comment">
    <div class="commenttext">this is what i tried (a while ago), dunno how workable condition that is but when i was trying this was ok, apart from bullshit history entries with none tags selected when switching tags (as described above), so perhaps it would be possible to filter these out and have this working</div></div>

      <div class="attachments">
          <a title="history-attempt.patch" href="?getfile=203" >
                <img src="https://awesomewm.org/bugs/themes/Bluey/mime/text.png" alt="" title="text/plain" />
            &nbsp;&nbsp;
            history-attempt.patch
                  </a>
                  (2.5 KiB)
          <br />
    </div>
  

  
  </div>
<div id="related" class="tab">
  <table>    <tr><td>
    <form method="post" action="https://awesomewm.org/bugs/index.php?do=details&amp;task_id=532#related" >
        <table id="tasks_related" class="userlist">
        <tr>
          <th>
            <a href="javascript:ToggleSelected('tasks_related')">
              <img title="Toggle Selected" alt="Toggle Selected" src="https://awesomewm.org/bugs/themes/Bluey/kaboodleloop.png" width="16" height="16" />
            </a>
          </th>
          <th>Tasks related to this task (0)</th>
        </tr>
                <tr>
          <td colspan="2">
            <input type="hidden" name="action" value="remove_related" />
            <input type="hidden" name="task_id" value="532" />
            <button type="submit">Remove</button>
          </td>
        </tr>
        </table>
    </form>
    </td><td>
    
    <table id="duplicate_tasks" class="userlist">
        <tr>
          <th>Duplicate tasks of this task (0)</th>
        </tr>
            </table>
    </td></tr>
  </table>

  </div>
<div id="history" class="tab">
  <h3>Loading...</h3>
</div>
    </div>
    <p id="footer">
       <!-- Please don't remove this line - it helps promote Flyspray -->
       <a href="http://flyspray.org/" class="offsite">Powered by Flyspray</a>
    </p>
  </div>
  </body>
</html>
