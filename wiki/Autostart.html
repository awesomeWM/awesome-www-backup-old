<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" />
<title>Autostart - awesome</title>
<meta name="generator" content="MediaWiki 1.24.2" />
<link rel="alternate" type="application/x-wiki" title="Edit" href="/w/index.php?title=Autostart&amp;action=edit" />
<link rel="edit" title="Edit" href="/w/index.php?title=Autostart&amp;action=edit" />
<link rel="shortcut icon" href="/images/icons/aw_16.png" />
<link rel="search" type="application/opensearchdescription+xml" href="/w/opensearch_desc.php" title="awesome (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://awesomewm.org/w/api.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="/wiki/Autostart" />
<link rel="copyright" href="https://creativecommons.org/licenses/by/3.0/" />
<link rel="alternate" type="application/atom+xml" title="awesome Atom feed" href="/w/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="https://awesomewm.org/w/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.skinning.content.externallinks%7Cmediawiki.skinning.interface%7Cmediawiki.ui.button%7Cskins.monobook.styles&amp;only=styles&amp;skin=monobook&amp;*" />
<!--[if IE 6]><link rel="stylesheet" href="/w/skins/MonoBook/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/w/skins/MonoBook/IE70Fixes.css?303" media="screen" /><![endif]--><meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="https://awesomewm.org/w/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=monobook&amp;*" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: awesome:resourceloader:filter:minify-css:7:ad506c29508072131b881ff3f2f9d363 */</style>
<script src="https://awesomewm.org/w/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=monobook&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Autostart","wgTitle":"Autostart","wgCurRevisionId":7340,"wgRevisionId":7340,"wgArticleId":171,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Awesome3"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Autostart","wgIsProbablyEditable":true,"wgRestrictionEdit":[],"wgRestrictionMove":[]});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"editfont":"default","editondblclick":0,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":1,"extendwatchlist":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nickname":"","norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"rcdays":7,"rclimit":50,"rows":25,"showhiddencats":0,"shownumberswatching":1,"showtoolbar":1,"skin":"monobook","stubthreshold":0,"thumbsize":5,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":1,"watchdefault":1,"watchdeletion":0,"watchlistdays":3,"watchlisthideanons":0,"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"watchrollback":0,
"wllimit":250,"useeditwarning":1,"prefershttps":1,"language":"en","variant-gan":"gan","variant-iu":"iu","variant-kk":"kk","variant-ku":"ku","variant-shi":"shi","variant-sr":"sr","variant-tg":"tg","variant-uz":"uz","variant-zh":"zh","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false,"variant":"en"});},{},{});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});},{},{});
/* cache key: awesome:resourceloader:filter:minify-js:7:ab52f6eb1652fbc58fa39bdfdc3926f5 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax"]);
}</script>
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Autostart skin-monobook action-view">
<div id="globalWrapper">
		<div id="column-content">
			<div id="content" class="mw-body" role="main">
				<a id="top"></a>
									<div id="siteNotice"><div id="localNotice" lang="en" dir="ltr"><p><b>This wiki will shut down!</b>
</p><p>Please note that this wiki will be made read-only and eventually be taken offline.
</p><p>A replacement is being discussed at <a rel="nofollow" class="external free" href="https://github.com/awesomeWM/awesome-www/issues/7">https://github.com/awesomeWM/awesome-www/issues/7</a>. We'd be happy to have more input for that discussion and volunteers who help us migrate the content of this wiki to its replacement.
</p></div></div>
				<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">Autostart</span></h1>

				<div id="bodyContent" class="mw-body-content">
					<div id="siteSub">From awesome</div>
					<div id="contentSub"></div>
										<div id="jump-to-nav" class="mw-jump">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>

					<!-- start content -->
					<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="LanguageLinks">
<table width="100%">
<tr valign="top" style="background: #EEF3E2">
<td style="width: 25px; padding-left: 0.5em;"><img alt="Languages" src="/w/images/thumb/Geographylogo.png/25px-Geographylogo.png" width="25" height="25" srcset="/w/images/thumb/Geographylogo.png/38px-Geographylogo.png 1.5x, /w/images/Geographylogo.png 2x" /></td>
<td style="width: 10px; white-space: nowrap; padding: 4px 1em 0 0.5em; border-right: 1px solid #aaaaaa;"><b>Languages:</b>&#160;</td><td style="padding: 1px 1em 0; background: #F6F9ED;">
<p><b><strong class="selflink">English</strong></b>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
&#160;&#8226;&#160;<span lang="ru"><a href="/wiki/Autostart/ru" title="Autostart/ru">русский</a></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
&#160;&#8226;&#160;<span lang="zh"><a href="/wiki/Autostart/zh" title="Autostart/zh">中文</a></span>
<span></span>
<span></span>
<span></span>
</p>
</td></tr></table></div>
<p>Awesome does not provide autostart functionality; not in the sense of freedesktop autostart specification and using <i>*.desktop</i> files. Below are some solutions for you to consider.
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Traditional_way"><span class="tocnumber">1</span> <span class="toctext">Traditional way</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Freedesktop_autostart_way"><span class="tocnumber">2</span> <span class="toctext">Freedesktop autostart way</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Simple_way"><span class="tocnumber">3</span> <span class="toctext">Simple way</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Directory_way"><span class="tocnumber">4</span> <span class="toctext">Directory way</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#PID_way"><span class="tocnumber">5</span> <span class="toctext">PID way</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#The_native_lua_way"><span class="tocnumber">6</span> <span class="toctext">The native lua way</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#The_X_way"><span class="tocnumber">7</span> <span class="toctext">The X way</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#The_X_Resources_way"><span class="tocnumber">8</span> <span class="toctext">The X Resources way</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Traditional_way">Traditional way</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/w/index.php?title=Autostart&amp;action=edit&amp;section=1" title="Edit section: Traditional way">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The <b>xinit</b> program is used to start the X server and clients on systems that don't have, or use, a display login manager like GDM/KDM/XDM. When <i>xinit</i> is run without specific client options it looks for a file called <b>.xinitrc</b> in the user's home directory and runs it as a shell script. This configuration file/script is used to start up client programs.
</p><p>You can run any application from your <i>~/.xinitrc</i> file but keep in mind that programs which do not return or exit right way you need to send to the background, so they don't block other programs from starting. Only the last started program, your window manager (awesome in this case), should be left in the foreground so the script doesn't exit until you quit awesome, and so <i>xinit</i> can clean up after it.
</p><p>If you are used to start the X server with the <b>startx</b> command, and by now wondering how this will affect you, do not worry the <i>startx</i> command is only a front-end to <i>xinit</i>, and your <i>~/.xinitrc</i> file will also be executed. Very simple <i>.xinitrc</i> file as an example:
</p>
<pre> #!/bin/sh
 #
 # User's .xinitrc file
 
 # Merge custom X resources
 xrdb -merge "${HOME}/.Xresources"
 
 # Play a startup sound, in the background
 ogg123 -q "${HOME}/.config/awesome/login.ogg" &amp;
 
 # Start a terminal emulator in the background
 urxvt -T Terminal &amp;
 
 # Start the window manager
 exec awesome
</pre>
<p><br />
Here is a good example of a more complex <i>.xinitrc</i> file you can learn from: <a rel="nofollow" class="external free" href="http://git.sysphere.org/dotfiles/tree/xinitrc">http://git.sysphere.org/dotfiles/tree/xinitrc</a>
</p><p><b>Note:</b> If you start awesome with <i>ck-launch-session</i>, you might want to create a separate start script and exec awesome from there or you can use an alternative way of starting the apps from inside rc.lua. Link to a related issue:  <a rel="nofollow" class="external free" href="https://bbs.archlinux.org/viewtopic.php?pid=1085191">https://bbs.archlinux.org/viewtopic.php?pid=1085191</a>
</p><p>If you are using a login manager, most will expect you to use the window manager to autostart applications; continue reading for various methods to do that with awesome.  However some read .xprofile and some read .xsession.  gdm, kdm, and lightdm all use .xprofile.  It is run before the window manager is started so it can't be used to start graphical applications but it is a good way autostart background things or set environment variables that you would normally do in .xinitrc if you weren't using a login manager.
</p>
<h2><span class="mw-headline" id="Freedesktop_autostart_way">Freedesktop autostart way</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/w/index.php?title=Autostart&amp;action=edit&amp;section=2" title="Edit section: Freedesktop autostart way">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>As stated in the first sentence on this page awesome does not implement the
Freedesktop way of spawning applications at startup but this shouldn't hinder
you to use it anyway.
</p><p>The <b>dex</b> program interprets *.desktop files in the locations specified by
Freedesktop autostart documentation. Just run it like this via one of the ways described above/below:
</p>
<pre>  dex -a -e Awesome
</pre>
<p>For specifying which applications shall be started use
<b>gnome-session-properties</b> or similar programs from Gnome or KDE.
</p><p>You should also be able to symlink autostart entries from /usr/share/applications into ~/.config/autostart.
Dex will then be able to find your user-specific autostart apps and run them. Verify with:
</p>
<pre>  dex -a -e Awesome -d
</pre>
<p>Dex can be downloaded here: <a rel="nofollow" class="external free" href="http://github.com/jceb/dex">http://github.com/jceb/dex</a>.
Or can be installed directly from Archlinux by running "pacman -S <a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/community/any/dex/">dex</a>".
</p>
<h2><span class="mw-headline" id="Simple_way">Simple way</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/w/index.php?title=Autostart&amp;action=edit&amp;section=3" title="Edit section: Simple way">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Just add lines to end of your ~/.config/awesome/rc.lua:
</p>
<pre>
awful.util.spawn_with_shell(&quot;COMMAND1&quot;)
awful.util.spawn_with_shell(&quot;COMMAND2&quot;)
</pre>
<p><br />
</p><p><b>My Example:</b>
</p>
<pre>
awful.util.spawn_with_shell(&quot;kdeinit&quot;)
awful.util.spawn_with_shell(&quot;lineakd&quot;)
awful.util.spawn_with_shell(&quot;anyremote -f ~/.anyRemote/amarok.cfg&quot;)
awful.util.spawn_with_shell(&quot;~/scripts/trm&quot;)
awful.util.spawn_with_shell(&quot;xchat&quot;)
awful.util.spawn_with_shell(&quot;psi&quot;)
awful.util.spawn_with_shell(&quot;firefox-bin&quot;)
awful.util.spawn_with_shell(&quot;gvim +Project&quot;)
awful.util.spawn_with_shell(&quot;kchmviewer&quot;)
awful.util.spawn_with_shell(&quot;amarok&quot;)
awful.util.spawn_with_shell(&quot;kmix&quot;)
awful.util.spawn_with_shell(&quot;kbluetoothd&quot;)
awful.util.spawn_with_shell(&quot;sudo killall mplayer&quot;)
</pre>
<p>If you want to run your apps only once and not every time awesome is restarted, create this simple script:
</p>
<pre>
#! /bin/bash

# Run program unless it's already running.

if [ -z &quot;`ps -Af | grep -o -w &quot;.*$1&quot; | grep -v grep | grep -v run-once`&quot; ]; then
  $@
fi
</pre>
<p>Or this:
</p>
<pre>
#!/bin/bash
#Alternative
pgrep $@ &gt; /dev/null || ($@ &amp;)
</pre>
<p>Save it as "run_once" somewhere in your $PATH and make it executable. Then autostart your apps like this:
</p>
<pre>awful.util.spawn_with_shell(&quot;run_once amarok&quot;)</pre>
<p>Alternatively you can use the following to avoid an external script (this also ignore commands running as other users than yourself):
</p>
<pre>
function run_once(cmd)
  findme = cmd
  firstspace = cmd:find(&quot; &quot;)
  if firstspace then
    findme = cmd:sub(0, firstspace-1)
  end
  awful.util.spawn_with_shell(&quot;pgrep -u $USER -x &quot; .. findme .. &quot; &gt; /dev/null || (&quot; .. cmd .. &quot;)&quot;)
end

run_once(&quot;amarok&quot;)
run_once(&quot;xscreensaver -no-splash&quot;)
</pre>
<p>Or this slightly more advanced version which permits to use command line options and to specify on which screen to launch your programs. It also allows for the case when the name of the process is different from the name of the command used to launch it (e.g. with wicd-client).
</p>
<pre>
function run_once(prg,arg_string,pname,screen)
    if not prg then
        do return nil end
    end

    if not pname then
       pname = prg
    end

    if not arg_string then 
        awful.util.spawn_with_shell(&quot;pgrep -f -u $USER -x '&quot; .. pname .. &quot;' || (&quot; .. prg .. &quot;)&quot;,screen)
    else
        awful.util.spawn_with_shell(&quot;pgrep -f -u $USER -x '&quot; .. pname .. &quot; &quot;.. arg_string ..&quot;' || (&quot; .. prg .. &quot; &quot; .. arg_string .. &quot;)&quot;,screen)
    end
end

run_once(&quot;xscreensaver&quot;,&quot;-no-splash&quot;)
run_once(&quot;pidgin&quot;,nil,nil,2)
run_once(&quot;wicd-client&quot;,nil,&quot;/usr/bin/python2 -O /usr/share/wicd/gtk/wicd-client.py&quot;)

</pre>
<p>Alternatively, if you want to start multiple instances of terminal with different window names, it is possible to use a variation of the above, though this also requires installation of wmctrl.
</p><p>Save this small bash file somewhere on your $PATH and make it executable:
</p>
<pre>
#!/bin/bash
EXPECTED_ARGS=2

if [ $# -ne $EXPECTED_ARGS ]
then
  exit 1
fi

COUNT=`wmctrl -l -x | grep $1 | wc -l`

if [ &quot;$COUNT&quot; -lt &quot;$2&quot; ]
then
  exit 0
else
  exit 1
fi
</pre>
<p>The autostart commands will look something like this. Usually with rules to place name="SSH" on a different tag from name="log":
</p>
<pre>
awful.util.spawn_with_shell(&quot;run_limited SSH 4 &amp;&amp; urxvt -name SSH&quot;);
awful.util.spawn_with_shell(&quot;run_limited SSH 4 &amp;&amp; urxvt -name SSH&quot;);
awful.util.spawn_with_shell(&quot;run_limited SSH 4 &amp;&amp; urxvt -name SSH&quot;);
awful.util.spawn_with_shell(&quot;run_limited SSH 4 &amp;&amp; urxvt -name SSH&quot;);
awful.util.spawn_with_shell(&quot;run_limited log 2 &amp;&amp; urxvt -name log&quot;);
awful.util.spawn_with_shell(&quot;run_limited log 2 &amp;&amp; urxvt -name log&quot;);
</pre>
<h2><span class="mw-headline" id="Directory_way">Directory way</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/w/index.php?title=Autostart&amp;action=edit&amp;section=4" title="Edit section: Directory way">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<pre>
-- Autostart
function autostart(dir)
    if not dir then
        do return nil end
    end
    local fd = io.popen(&quot;ls -1 -F &quot; .. dir)
    if not fd then
        do return nil end
    end
    for file in fd:lines() do
        local c= string.sub(file,-1)   -- last char
        if c=='*' then  -- executables
            executable = string.sub( file, 1,-2 )
            print(&quot;Awesome Autostart: Executing: &quot; .. executable)
            awful.util.spawn_with_shell(dir .. &quot;/&quot; .. executable .. &quot;&quot;) -- launch in bg
        elseif c=='@' then  -- symbolic links
            print(&quot;Awesome Autostart: Not handling symbolic links: &quot; .. file)
        else
            print (&quot;Awesome Autostart: Skipping file &quot; .. file .. &quot; not executable.&quot;)
        end
    end
    io.close(fd)
end

autostart_dir = os.getenv(&quot;HOME&quot;) .. &quot;/.config/autostart&quot;
autostart(autostart_dir)
</pre>
<p>Be aware of the following drawbacks (and maybe fix them):
</p>
<ul><li> the files in the autostart directory will be run everytime you re-parse the config file. If you re-parse the config file multiple times during a session this might cause strange behavior. If an application should only be run once, please handle this in the corresponding autostart script.</li>
<li> The function currently ignores symlinks (I do not need them).</li></ul>
<h2><span class="mw-headline" id="PID_way">PID way</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/w/index.php?title=Autostart&amp;action=edit&amp;section=5" title="Edit section: PID way">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Put this in runonce.lua
</p>
<pre>
-- @author Peter J. Kranz (Absurd-Mind, peter@myref.net)
-- Any questions, criticism or praise just drop me an email

local M = {}

-- get the current Pid of awesome
local function getCurrentPid()
    -- get awesome pid from pgrep
    local fpid = io.popen(&quot;pgrep -u &quot; .. os.getenv(&quot;USER&quot;) .. &quot; -o awesome&quot;)
    local pid = fpid:read(&quot;*n&quot;)
    fpid:close()

    -- sanity check
    if pid == nil then
        return -1
    end

    return pid
end

local function getOldPid(filename)
    -- open file
    local pidFile = io.open(filename)
    if pidFile == nil then
        return -1
    end

    -- read number
    local pid = pidFile:read(&quot;*n&quot;)
    pidFile:close()

    -- sanity check
    if pid &lt;= 0 then
        return -1
    end

    return pid;
end

local function writePid(filename, pid)
    local pidFile = io.open(filename, &quot;w+&quot;)
    pidFile:write(pid)
    pidFile:close()
end

local function shallExecute(oldPid, newPid)
    -- simple check if equivalent
    if oldPid == newPid then
        return false
    end

    return true
end

local function getPidFile()
    local host = io.lines(&quot;/proc/sys/kernel/hostname&quot;)()
    return awful.util.getdir(&quot;cache&quot;) .. &quot;/awesome.&quot; .. host .. &quot;.pid&quot;
end

-- run Once per real awesome start (config reload works)
-- does not cover &quot;pkill awesome &amp;&amp; awesome&quot;
function M.run(shellCommand)
    -- check and Execute
    if shallExecute(M.oldPid, M.currentPid) then
        awful.util.spawn_with_shell(shellCommand)
    end
end

M.pidFile = getPidFile()
M.oldPid = getOldPid(M.pidFile)
M.currentPid = getCurrentPid()
writePid(M.pidFile, M.currentPid)

return M
</pre>
<p>Use it this way:
</p>
<pre>
local r = require(&quot;runonce&quot;)

r.run(&quot;urxvtd -q -o -f&quot;)
r.run(&quot;urxvtc&quot;)
r.run(&quot;urxvtc&quot;)
r.run(&quot;wmname LG3D&quot;)
</pre>
<p><b>NOTE:</b> the runonce.lua will only work if the window manager is started as "awesome". If it is started from a symlink (say, as x-window-manager on Debian), it will fail. An alternative is to replace the <code>--get awesome pid from pgrep</code> part to retrieve its PID directly from /proc instead of relying on pgrep and an unstable name:
</p>
<pre>
-- get awesome pid from /proc
local fpid = assert(io.open(&quot;/proc/self/stat&quot;, &quot;r&quot;))
local pid = fpid:read(&quot;*all&quot;)
fpid:close()
pid = string.match(t, &quot;%S+&quot;)
</pre>
<h2><span class="mw-headline" id="The_native_lua_way">The native lua way</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/w/index.php?title=Autostart&amp;action=edit&amp;section=6" title="Edit section: The native lua way">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This solution doesn't depend on external tools, which speed up your startup.
</p><p>To use this code snippet luafilesystem alias lfs is required.
</p><p>It should be avaible for every system: debian (lua-filesystem), freebsd (ports/devel/luafilesystem/), gentoo (dev-lua/luafilesystem), ubuntu (liblua5.1-filesystem0), archlinux (lua-filesystem)
</p><p>@bsdguys: don't forget to mount procfs (:
</p>
<pre>
require(&quot;lfs&quot;) 
-- {{{ Run programm once
local function processwalker()
   local function yieldprocess()
      for dir in lfs.dir(&quot;/proc&quot;) do
        -- All directories in /proc containing a number, represent a process
        if tonumber(dir) ~= nil then
          local f, err = io.open(&quot;/proc/&quot;..dir..&quot;/cmdline&quot;)
          if f then
            local cmdline = f:read(&quot;*all&quot;)
            f:close()
            if cmdline ~= &quot;&quot; then
              coroutine.yield(cmdline)
            end
          end
        end
      end
    end
    return coroutine.wrap(yieldprocess)
end

local function run_once(process, cmd)
   assert(type(process) == &quot;string&quot;)
   local regex_killer = {
      [&quot;+&quot;]  = &quot;%+&quot;, [&quot;-&quot;] = &quot;%-&quot;,
      [&quot;*&quot;]  = &quot;%*&quot;, [&quot;?&quot;]  = &quot;%?&quot; }

   for p in processwalker() do
      if p:find(process:gsub(&quot;[-+?*]&quot;, regex_killer)) then
	 return
      end
   end
   return awful.util.spawn(cmd or process)
end
-- }}}

-- Usage Example
run_once(&quot;firefox&quot;)
run_once(&quot;dropboxd&quot;)
-- Use the second argument, if the programm you wanna start, 
-- differs from the what you want to search.
run_once(&quot;redshift&quot;, &quot;nice -n19 redshift -l 51:14 -t 5700:4500&quot;)

</pre>
<h2><span class="mw-headline" id="The_X_way">The X way</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/w/index.php?title=Autostart&amp;action=edit&amp;section=7" title="Edit section: The X way">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Another way to detect if a process is already running is to check if there is a window for it. This only works for processes that connect to the X server. There are two drawbacks with this approach. First, awesome does not maintain a list of all clients, just for clients that have regular windows. If a client is window-less (for example, a systray icon), it is not listed by awesome. Second, the list of clients is only available once awesome has started completely, not during the initialization.
</p><p>We can circumvent the first problem by using (as a fallback) xwininfo. The second problem is worked around with a timer. Here is the code:
</p>
<pre>
local xrun_now = function(name, cmd)
   -- Try first the list of clients from awesome (which is available
   -- only if awesome has fully started, therefore, this function
   -- should be run inside a 0 timer)
   local squid = { name, name:sub(1,1):upper() .. name:sub(2) }
   if awful.client.cycle(
      function(c)
	 return awful.rules.match_any(c,
				      { name = squid,
					class = squid,
					instance = squid })
      end)() then
      return
   end

   -- Not found, let's check with xwininfo. We can only check name but
   -- we can catch application without a window...
   if os.execute(&quot;xwininfo -name '&quot; .. name .. &quot;' &gt; /dev/null 2&gt; /dev/null&quot;) == 0 then
      return
   end
   awful.util.spawn_with_shell(cmd or name)
end

-- Run a command if not already running.
xrun = function(name, cmd)
   -- We need to wait for awesome to be ready. Hence the timer.
   local stimer = timer { timeout = 0 }
   local run = function()
      stimer:stop()
      xrun_now(name, cmd)
   end
   stimer:add_signal(&quot;timeout&quot;, run)
   stimer:start()
end
</pre>
<p>Example of use:
</p>
<pre>
xrun(&quot;chromium&quot;)
xrun(&quot;pidgin&quot;, &quot;pidgin -n&quot;)
</pre>
<p>First argument is the name of the program (name of window, instance or class, it will also be searched capitalized). The second is the command to run. The first argument is used as a command if no second argument is provided.
</p>
<h2><span class="mw-headline" id="The_X_Resources_way">The X Resources way</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/w/index.php?title=Autostart&amp;action=edit&amp;section=8" title="Edit section: The X Resources way">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>This script sets an XResource property to indicate that autorun was already run. This method is in my opinion the most reliable one. XResources exist only in RAM so no cleanup is necessary and XResources exist for as long as the X session exist.
</p><p>The code also redirects the output of all methods started by dex to a tempfile instead of ~/.xsession-errors.
</p>
<pre>
#!/bin/sh

PROP=autostart.wasrun
HASPROP=$(xrdb -query|grep $PROP)

if [ &quot;$HASPROP&quot;&#160;!= &quot;&quot; ]
then
  exit 0;
fi

TEMPLATE=xsession-$USER-$PPID-XXX
TEMPFILE=$(mktemp --tmpdir $TEMPLATE)

echo &quot;logging to $TEMPFILE&quot;

echo &quot;$PROP: on&quot; | xrdb -merge

( $HOME/bin/dex -v -a 2&gt;&amp;1 1&gt;$TEMPFILE ) &amp;
</pre>
<p>I have no deeper knowledge on X resources so I'd be happy if somebody would 
like to review this.
</p><p>This is a similar approach that runs in lua instead of shell:
</p>
<pre>
xrun = function(cmd, late)
    local xresources = awful.util.pread(&quot;xrdb -query&quot;)
    local myxr = xresources:match(&quot;^awesome%.xrun:%s+.-\n&quot;)
                 or xresources:match(&quot;\nawesome%.xrun:%s+.-\n&quot;)
                 or &quot;awesome.xrun:&quot;
    myxr = myxr:gsub(&quot;\n&quot;, &quot;&quot;)
    if not string.find(myxr, cmd, 1, true) then
        -- use pread so that this runs synchronously
        awful.util.pread(&quot;echo '&quot; .. myxr .. &quot; &quot; .. cmd:gsub(&quot;'&quot;, &quot;\\'&quot;) .. &quot;'|xrdb -merge&quot;)
        if late then
            local stimer = timer { timeout = late }
            local run = function()
                stimer:stop()
                awful.util.spawn(cmd, false)
            end
            stimer:connect_signal(&quot;timeout&quot;, run)
            stimer:start()
        else
            awful.util.spawn(cmd, false)
        end
    end
end
</pre>
<p>Or using a more general method to do anything on start but not restart
</p>
<pre>
local xresources_name = &quot;awesome.started&quot;
local xresources = awful.util.pread(&quot;xrdb -query&quot;)
if not xresources:match(xresources_name) then
    -- Execute once for X server
    os.execute(&quot;dex -a -e Awesome&quot;)
end
awful.util.spawn_with_shell(&quot;xrdb -merge &lt;&lt;&lt; &quot; .. &quot;'&quot; .. xresources_name .. &quot;: true'&quot;)
</pre>
<ul><li> Wouldn't it be nice if awesome lua would have functions to manipulate and query X resources?</li></ul>
<ul><li> Wouldn't it be nice if awesome would by itself already set an X resource property once it has completed the processing of its configuration? Later restarts could then check whether this property is already set.</li></ul>
<ul><li> Wouldn't it be nice if there'd actually be some free desktop standard property to be set once a window manager has fully started up?</li></ul>

<!-- 
NewPP limit report
CPU time usage: 0.136 seconds
Real time usage: 0.156 seconds
Preprocessor visited node count: 902/1000000
Preprocessor generated node count: 1728/1000000
Post‐expand include size: 3724/2097152 bytes
Template argument size: 126/2097152 bytes
Highest expansion depth: 6/40
Expensive parser function count: 49/100
-->

<!-- Saved in parser cache with key awesome:pcache:idhash:171-0!*!0!!en!5!* and timestamp 20160514190605 and revision id 7340
 -->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="https://awesomewm.org/w/index.php?title=Autostart&amp;oldid=7340">https://awesomewm.org/w/index.php?title=Autostart&amp;oldid=7340</a>"</div>
					<div id='catlinks' class='catlinks'><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="/wiki/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="/wiki/Category:Awesome3" title="Category:Awesome3">Awesome3</a></li></ul></div></div>					<!-- end content -->
										<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div id="column-one">
			<h2>Navigation menu</h2>
					<div id="p-cactions" class="portlet" role="navigation">
			<h3>Views</h3>

			<div class="pBody">
				<ul>
				<li id="ca-nstab-main" class="selected"><a href="/wiki/Autostart" title="View the content page [c]" accesskey="c">Page</a></li>
				<li id="ca-talk" class="new"><a href="/w/index.php?title=Talk:Autostart&amp;action=edit&amp;redlink=1" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				<li id="ca-edit"><a href="/w/index.php?title=Autostart&amp;action=edit" title="You can edit this page. Please use the preview button before saving [e]" accesskey="e">Edit</a></li>
				<li id="ca-history"><a href="/w/index.php?title=Autostart&amp;action=history" rel="archives" title="Past revisions of this page [h]" accesskey="h">History</a></li>
				</ul>
							</div>
		</div>
				<div class="portlet" id="p-personal" role="navigation">
				<h3>Personal tools</h3>

				<div class="pBody">
					<ul>
													<li id="pt-login"><a href="/w/index.php?title=Special:UserLogin&amp;returnto=Autostart" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
											</ul>
				</div>
			</div>
			<div class="portlet" id="p-logo" role="banner">
				<a href="/wiki/Main_Page" style="background-image: url(/images/icons/aw_64.png);" title="Visit the main page"></a>
			</div>
				<div class="generated-sidebar portlet" id="p-navigation" role="navigation">
		<h3>Navigation</h3>
		<div class='pBody'>
							<ul>
											<li id="n-mainpage-description"><a href="/wiki/Main_Page" title="Visit the main page [z]" accesskey="z">Main page</a></li>
											<li id="n-Homepage"><a href="http://awesome.naquadah.org" rel="nofollow">Homepage</a></li>
											<li id="n-recentchanges"><a href="/wiki/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
											<li id="n-randompage"><a href="/wiki/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
											<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>
									</ul>
					</div>
		</div>
			<div id="p-search" class="portlet" role="search">
			<h3><label for="searchInput">Search</label></h3>

			<div id="searchBody" class="pBody">
				<form action="/w/index.php" id="searchform">
					<input type='hidden' name="title" value="Special:Search"/>
					<input type="search" name="search" placeholder="Search" title="Search awesome [f]" accesskey="f" id="searchInput" />
					<input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchGoButton" class="searchButton" />&#160;
						<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton" />
				</form>

							</div>
		</div>
			<div class="portlet" id="p-tb" role="navigation">
			<h3>Tools</h3>

			<div class="pBody">
				<ul>
											<li id="t-whatlinkshere"><a href="/wiki/Special:WhatLinksHere/Autostart" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
											<li id="t-recentchangeslinked"><a href="/wiki/Special:RecentChangesLinked/Autostart" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
											<li id="t-specialpages"><a href="/wiki/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
											<li id="t-print"><a href="/w/index.php?title=Autostart&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
											<li id="t-permalink"><a href="/w/index.php?title=Autostart&amp;oldid=7340" title="Permanent link to this revision of the page">Permanent link</a></li>
											<li id="t-info"><a href="/w/index.php?title=Autostart&amp;action=info">Page information</a></li>
									</ul>
							</div>
		</div>
			</div><!-- end of the left (by default at least) column -->
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
						<div id="f-copyrightico">
									<a href="https://creativecommons.org/licenses/by/3.0/"><img src="https://i.creativecommons.org/l/by/3.0/88x31.png" alt="Attribution 3.0 Unported" width="88" height="31" /></a>
							</div>
					<div id="f-poweredbyico">
									<a href="//www.mediawiki.org/"><img src="/w/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>
							</div>
					<ul id="f-list">
									<li id="lastmod"> This page was last modified on 13 September 2015, at 10:25.</li>
									<li id="viewcount">This page has been accessed 196,045 times.</li>
									<li id="copyright">Content is available under <a class="external" rel="nofollow" href="https://creativecommons.org/licenses/by/3.0/">Attribution 3.0 Unported</a> unless otherwise noted.</li>
									<li id="privacy"><a href="/wiki/awesome:Privacy_policy" title="awesome:Privacy policy">Privacy policy</a></li>
									<li id="about"><a href="/wiki/awesome:About" title="awesome:About">About awesome</a></li>
									<li id="disclaimer"><a href="/wiki/awesome:General_disclaimer" title="awesome:General disclaimer">Disclaimers</a></li>
							</ul>
		</div>
		</div>
		<script>/*<![CDATA[*/window.jQuery && jQuery.ready();/*]]>*/</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://awesomewm.org/w/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=monobook\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":71});
}</script></body></html>