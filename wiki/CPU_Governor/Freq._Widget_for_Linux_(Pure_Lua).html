<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" />
<title>CPU Governor/Freq. Widget for Linux (Pure Lua) - awesome</title>
<meta name="generator" content="MediaWiki 1.24.2" />
<link rel="alternate" type="application/x-wiki" title="Edit" href="/w/index.php?title=CPU_Governor/Freq._Widget_for_Linux_(Pure_Lua)&amp;action=edit" />
<link rel="edit" title="Edit" href="/w/index.php?title=CPU_Governor/Freq._Widget_for_Linux_(Pure_Lua)&amp;action=edit" />
<link rel="shortcut icon" href="/images/icons/aw_16.png" />
<link rel="search" type="application/opensearchdescription+xml" href="/w/opensearch_desc.php" title="awesome (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://awesomewm.org/w/api.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="/wiki/CPU_Governor/Freq._Widget_for_Linux_(Pure_Lua)" />
<link rel="copyright" href="https://creativecommons.org/licenses/by/3.0/" />
<link rel="alternate" type="application/atom+xml" title="awesome Atom feed" href="/w/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="https://awesomewm.org/w/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.skinning.content.externallinks%7Cmediawiki.skinning.interface%7Cmediawiki.ui.button%7Cskins.monobook.styles&amp;only=styles&amp;skin=monobook&amp;*" />
<!--[if IE 6]><link rel="stylesheet" href="/w/skins/MonoBook/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/w/skins/MonoBook/IE70Fixes.css?303" media="screen" /><![endif]--><meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="https://awesomewm.org/w/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=monobook&amp;*" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: awesome:resourceloader:filter:minify-css:7:ad506c29508072131b881ff3f2f9d363 */</style>
<script src="https://awesomewm.org/w/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=monobook&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"CPU_Governor/Freq._Widget_for_Linux_(Pure_Lua)","wgTitle":"CPU Governor/Freq. Widget for Linux (Pure Lua)","wgCurRevisionId":2460,"wgRevisionId":2460,"wgArticleId":302,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Widgets","Awesome3"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"CPU_Governor/Freq._Widget_for_Linux_(Pure_Lua)","wgIsProbablyEditable":true,"wgRestrictionEdit":[],"wgRestrictionMove":[]});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"editfont":"default","editondblclick":0,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":1,"extendwatchlist":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nickname":"","norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"rcdays":7,"rclimit":50,"rows":25,"showhiddencats":0,"shownumberswatching":1,"showtoolbar":1,"skin":"monobook","stubthreshold":0,"thumbsize":5,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":1,"watchdefault":1,"watchdeletion":0,"watchlistdays":3,"watchlisthideanons":0,"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"watchrollback":0,
"wllimit":250,"useeditwarning":1,"prefershttps":1,"language":"en","variant-gan":"gan","variant-iu":"iu","variant-kk":"kk","variant-ku":"ku","variant-shi":"shi","variant-sr":"sr","variant-tg":"tg","variant-uz":"uz","variant-zh":"zh","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false,"variant":"en"});},{},{});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});},{},{});
/* cache key: awesome:resourceloader:filter:minify-js:7:ab52f6eb1652fbc58fa39bdfdc3926f5 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax"]);
}</script>
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-CPU_Governor_Freq_Widget_for_Linux_Pure_Lua skin-monobook action-view">
<div id="globalWrapper">
		<div id="column-content">
			<div id="content" class="mw-body" role="main">
				<a id="top"></a>
									<div id="siteNotice"><div id="localNotice" lang="en" dir="ltr"><p><b>This wiki will shut down!</b>
</p><p>Please note that this wiki will be made read-only and eventually be taken offline.
</p><p>A replacement is being discussed at <a rel="nofollow" class="external free" href="https://github.com/awesomeWM/awesome-www/issues/7">https://github.com/awesomeWM/awesome-www/issues/7</a>. We'd be happy to have more input for that discussion and volunteers who help us migrate the content of this wiki to its replacement.
</p></div></div>
				<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">CPU Governor/Freq. Widget for Linux (Pure Lua)</span></h1>

				<div id="bodyContent" class="mw-body-content">
					<div id="siteSub">From awesome</div>
					<div id="contentSub"></div>
										<div id="jump-to-nav" class="mw-jump">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>

					<!-- start content -->
					<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><p>by <a href="/wiki/User:Frax" title="User:Frax">Fredrik Ax</a> &lt;<a rel="nofollow" class="external free" href="mailto:frax@axnet.nu">mailto:frax@axnet.nu</a>&gt;
</p>
<table cellpadding="5" cellspacing="0" style="margin: 0em" width="100%">

<tr style="background: #aea">
<td> This widget is written entirely in LUA for awesome 3.2.
<p>It depends on sudo, cpufreq-set and Linux CPU_FREQ_GOV and SYSFS (/sys/devices/system/cpu/cpu0/cpufreq/scaling_*).
</p>
</td></tr></table>
<p>It provides a textbox widget that shows your current governor and what frequence your cpu currently is using.
</p><p>When left-clicked it opens a menu that allow you to select another governor (if you have the appropriate line
in sudoers). Right-clicked it simply updates it self.
</p><p><br />
</p>
<h2><span class="mw-headline" id="Prerequisites:">Prerequisites:</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/w/index.php?title=CPU_Governor/Freq._Widget_for_Linux_(Pure_Lua)&amp;action=edit&amp;section=1" title="Edit section: Prerequisites:">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>sudo and cpufreq-set must be in your path e.g. in Debian, as root do:
</p>
<pre>apt-get install sudo cpufrequtils
</pre>
<p>You must be allowed to run the command "sudo cpufreq-set ..." passwordless, e.g. by adding the following line to your /etc/sudoers:
</p>
<pre>username	ALL=(ALL) NOPASSWD:/usr/bin/cpufreq-set
</pre>
<p>where username is ... guess what ... your user name.
</p><p><br />
</p>
<h2><span class="mw-headline" id="Code_to_be_inserted_into_your_rc.lua">Code to be inserted into your rc.lua</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/w/index.php?title=CPU_Governor/Freq._Widget_for_Linux_(Pure_Lua)&amp;action=edit&amp;section=2" title="Edit section: Code to be inserted into your rc.lua">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The widget must be defined before it is added to the wibox where it is going to be used.
So using the mywibox as defined in the default rc.lua the code should be inserted <b>before</b>
the loop (for s = 1, screen.count() do) containing the statement starting with:
</p>
<pre>mywibox[s].widgets = {
</pre>
<p>This is the code to be inserted:
</p>
<pre>-- Create fraxcpumenu, and add all available governors to it
fraxcpumenu = {}
local fh= io.open("/sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors", "r")
if fh ~= nil then 
   govstr= fh:read()
   fh:close()
   local i= 1
   for w in string.gmatch(govstr, "%a+") do
      fraxcpumenu[i]= { w, "sudo cpufreq-set  --governor "..w}
      i= i + 1
   end
end
fraxcpumenu = awful.menu.new( { items= fraxcpumenu }  )

-- Create fraxcpu widget
fraxcpu=  widget({ type = "textbox", name = "fraxcpu", align = "right" })
fraxcpu.text= 'fraxcpu'

-- Function for updating the fraxcpu widget
fraxcpuupd=1
function hook_fraxcpu (tbw)
   if not fraxcpuupd then return(nil) end
   local freq= 
   local gov= 
   local fh= io.open("/sys/devices/system/cpu/cpu0/cpufreq/scaling_governor", "r")
   if fh then
      gov= fh:read()..':'
      fh:close()
   end
   fh= io.open("/sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq", "r")
   if fh then
      freq= fh:read()
      fh:close()
      freq= tostring(math.ceil(tonumber(freq)/1000))
   else
      fraxcpuupd= nil
      fh= io.open("/proc/cpuinfo", "r")
      if fh then
	 for l in fh:lines() do
	    freq= string.match(l, '^%s*cpu MHz%s*:%s*([0-9]+)')
	    if freq ~= nil then break end
	    freq= 
	 end
      end
   end
   tbw.text= gov..freq
end

-- Mouse button bindings for fraxcpu widget
fraxcpu.buttons(fraxcpu,{ button({ }, 1, function () awful.menu.toggle(fraxcpumenu) end),
			  button({ }, 2, function () hook_fraxcpu(fraxcpu) end),
			  button({ }, 3, function () hook_fraxcpu(fraxcpu) end) })
</pre>
<p>Don't forget to make the widget visible, e.g. by adding it to the mywibox as defined by the default rc.lua,
look for the line starting with
</p>
<pre>mywibox[s].widgets = {
</pre>
<p>and insert "fraxcpu," into the list of widgets.
</p><p>Finally you need to register a timer that keeps the widget updated. For it to be informational in environments
where the freq changes dynamically (e.g. when using the ondemand governor) it needs to be updated often.
</p><p>To update it every second add the following at the end of your rc.lua:
</p>
<pre>-- Update the fraxcpu widget every second
awful.hooks.timer.register(1, function ()
    hook_fraxcpu(fraxcpu) 
end)
</pre>
<!-- 
NewPP limit report
CPU time usage: 0.016 seconds
Real time usage: 0.017 seconds
Preprocessor visited node count: 7/1000000
Preprocessor generated node count: 12/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key awesome:pcache:idhash:302-0!*!0!!*!*!* and timestamp 20160515035030 and revision id 2460
 -->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="https://awesomewm.org/w/index.php?title=CPU_Governor/Freq._Widget_for_Linux_(Pure_Lua)&amp;oldid=2460">https://awesomewm.org/w/index.php?title=CPU_Governor/Freq._Widget_for_Linux_(Pure_Lua)&amp;oldid=2460</a>"</div>
					<div id='catlinks' class='catlinks'><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="/wiki/Special:Categories" title="Special:Categories">Categories</a>: <ul><li><a href="/wiki/Category:Widgets" title="Category:Widgets">Widgets</a></li><li><a href="/wiki/Category:Awesome3" title="Category:Awesome3">Awesome3</a></li></ul></div></div>					<!-- end content -->
										<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div id="column-one">
			<h2>Navigation menu</h2>
					<div id="p-cactions" class="portlet" role="navigation">
			<h3>Views</h3>

			<div class="pBody">
				<ul>
				<li id="ca-nstab-main" class="selected"><a href="/wiki/CPU_Governor/Freq._Widget_for_Linux_(Pure_Lua)" title="View the content page [c]" accesskey="c">Page</a></li>
				<li id="ca-talk" class="new"><a href="/w/index.php?title=Talk:CPU_Governor/Freq._Widget_for_Linux_(Pure_Lua)&amp;action=edit&amp;redlink=1" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				<li id="ca-edit"><a href="/w/index.php?title=CPU_Governor/Freq._Widget_for_Linux_(Pure_Lua)&amp;action=edit" title="You can edit this page. Please use the preview button before saving [e]" accesskey="e">Edit</a></li>
				<li id="ca-history"><a href="/w/index.php?title=CPU_Governor/Freq._Widget_for_Linux_(Pure_Lua)&amp;action=history" rel="archives" title="Past revisions of this page [h]" accesskey="h">History</a></li>
				</ul>
							</div>
		</div>
				<div class="portlet" id="p-personal" role="navigation">
				<h3>Personal tools</h3>

				<div class="pBody">
					<ul>
													<li id="pt-anonuserpage"><a href="/wiki/User:95.90.224.24" class="new" title="The user page for the IP address you are editing as [.]" accesskey=".">95.90.224.24</a></li>
													<li id="pt-anontalk"><a href="/wiki/User_talk:95.90.224.24" class="new" title="Discussion about edits from this IP address [n]" accesskey="n">Talk for this IP address</a></li>
													<li id="pt-login"><a href="/w/index.php?title=Special:UserLogin&amp;returnto=CPU+Governor%2FFreq.+Widget+for+Linux+%28Pure+Lua%29" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
											</ul>
				</div>
			</div>
			<div class="portlet" id="p-logo" role="banner">
				<a href="/wiki/Main_Page" style="background-image: url(/images/icons/aw_64.png);" title="Visit the main page"></a>
			</div>
				<div class="generated-sidebar portlet" id="p-navigation" role="navigation">
		<h3>Navigation</h3>
		<div class='pBody'>
							<ul>
											<li id="n-mainpage-description"><a href="/wiki/Main_Page" title="Visit the main page [z]" accesskey="z">Main page</a></li>
											<li id="n-Homepage"><a href="http://awesome.naquadah.org" rel="nofollow">Homepage</a></li>
											<li id="n-recentchanges"><a href="/wiki/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
											<li id="n-randompage"><a href="/wiki/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
											<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>
									</ul>
					</div>
		</div>
			<div id="p-search" class="portlet" role="search">
			<h3><label for="searchInput">Search</label></h3>

			<div id="searchBody" class="pBody">
				<form action="/w/index.php" id="searchform">
					<input type='hidden' name="title" value="Special:Search"/>
					<input type="search" name="search" placeholder="Search" title="Search awesome [f]" accesskey="f" id="searchInput" />
					<input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchGoButton" class="searchButton" />&#160;
						<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton" />
				</form>

							</div>
		</div>
			<div class="portlet" id="p-tb" role="navigation">
			<h3>Tools</h3>

			<div class="pBody">
				<ul>
											<li id="t-whatlinkshere"><a href="/wiki/Special:WhatLinksHere/CPU_Governor/Freq._Widget_for_Linux_(Pure_Lua)" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
											<li id="t-recentchangeslinked"><a href="/wiki/Special:RecentChangesLinked/CPU_Governor/Freq._Widget_for_Linux_(Pure_Lua)" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
											<li id="t-specialpages"><a href="/wiki/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
											<li id="t-print"><a href="/w/index.php?title=CPU_Governor/Freq._Widget_for_Linux_(Pure_Lua)&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
											<li id="t-permalink"><a href="/w/index.php?title=CPU_Governor/Freq._Widget_for_Linux_(Pure_Lua)&amp;oldid=2460" title="Permanent link to this revision of the page">Permanent link</a></li>
											<li id="t-info"><a href="/w/index.php?title=CPU_Governor/Freq._Widget_for_Linux_(Pure_Lua)&amp;action=info">Page information</a></li>
									</ul>
							</div>
		</div>
			</div><!-- end of the left (by default at least) column -->
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
						<div id="f-copyrightico">
									<a href="https://creativecommons.org/licenses/by/3.0/"><img src="https://i.creativecommons.org/l/by/3.0/88x31.png" alt="Attribution 3.0 Unported" width="88" height="31" /></a>
							</div>
					<div id="f-poweredbyico">
									<a href="//www.mediawiki.org/"><img src="/w/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>
							</div>
					<ul id="f-list">
									<li id="lastmod"> This page was last modified on 17 March 2009, at 12:53.</li>
									<li id="viewcount">This page has been accessed 4,973 times.</li>
									<li id="copyright">Content is available under <a class="external" rel="nofollow" href="https://creativecommons.org/licenses/by/3.0/">Attribution 3.0 Unported</a> unless otherwise noted.</li>
									<li id="privacy"><a href="/wiki/awesome:Privacy_policy" title="awesome:Privacy policy">Privacy policy</a></li>
									<li id="about"><a href="/wiki/awesome:About" title="awesome:About">About awesome</a></li>
									<li id="disclaimer"><a href="/wiki/awesome:General_disclaimer" title="awesome:General disclaimer">Disclaimers</a></li>
							</ul>
		</div>
		</div>
		<script>/*<![CDATA[*/window.jQuery && jQuery.ready();/*]]>*/</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://awesomewm.org/w/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;skin=monobook\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":79});
}</script></body></html>