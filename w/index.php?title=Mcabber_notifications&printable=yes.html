<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" />
<title>Mcabber notifications - awesome</title>
<meta name="generator" content="MediaWiki 1.24.2" />
<meta name="robots" content="noindex,follow" />
<link rel="alternate" type="application/x-wiki" title="Edit" href="/w/index.php?title=Mcabber_notifications&amp;action=edit" />
<link rel="edit" title="Edit" href="/w/index.php?title=Mcabber_notifications&amp;action=edit" />
<link rel="shortcut icon" href="/images/icons/aw_16.png" />
<link rel="search" type="application/opensearchdescription+xml" href="/w/opensearch_desc.php" title="awesome (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://awesomewm.org/w/api.php?action=rsd" />
<link rel="alternate" hreflang="x-default" href="/wiki/Mcabber_notifications" />
<link rel="copyright" href="https://creativecommons.org/licenses/by/3.0/" />
<link rel="alternate" type="application/atom+xml" title="awesome Atom feed" href="/w/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="https://awesomewm.org/w/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.skinning.content.externallinks%7Cmediawiki.skinning.interface%7Cmediawiki.ui.button%7Cskins.monobook.styles&amp;only=styles&amp;printable=1&amp;skin=monobook&amp;*" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="https://awesomewm.org/w/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;printable=1&amp;skin=monobook&amp;*" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: awesome:resourceloader:filter:minify-css:7:ad506c29508072131b881ff3f2f9d363 */</style>
<script src="https://awesomewm.org/w/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;printable=1&amp;skin=monobook&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Mcabber_notifications","wgTitle":"Mcabber notifications","wgCurRevisionId":5504,"wgRevisionId":5504,"wgArticleId":315,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Awesome3"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Mcabber_notifications","wgIsProbablyEditable":true,"wgRestrictionEdit":[],"wgRestrictionMove":[]});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"editfont":"default","editondblclick":0,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":1,"extendwatchlist":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nickname":"","norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"rcdays":7,"rclimit":50,"rows":25,"showhiddencats":0,"shownumberswatching":1,"showtoolbar":1,"skin":"monobook","stubthreshold":0,"thumbsize":5,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":1,"watchdefault":1,"watchdeletion":0,"watchlistdays":3,"watchlisthideanons":0,"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"watchrollback":0,
"wllimit":250,"useeditwarning":1,"prefershttps":1,"language":"en","variant-gan":"gan","variant-iu":"iu","variant-kk":"kk","variant-ku":"ku","variant-shi":"shi","variant-sr":"sr","variant-tg":"tg","variant-uz":"uz","variant-zh":"zh","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false,"variant":"en"});},{},{});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});},{},{});
/* cache key: awesome:resourceloader:filter:minify-js:7:ab52f6eb1652fbc58fa39bdfdc3926f5 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax"]);
}</script>
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Mcabber_notifications skin-monobook action-view">
<div id="globalWrapper">
		<div id="column-content">
			<div id="content" class="mw-body" role="main">
				<a id="top"></a>
									<div id="siteNotice"><div id="localNotice" lang="en" dir="ltr"><p><b>This wiki will shut down!</b>
</p><p>Please note that this wiki will be made read-only and eventually be taken offline.
</p><p>A replacement is being discussed at <a rel="nofollow" class="external free" href="https://github.com/awesomeWM/awesome-www/issues/7">https://github.com/awesomeWM/awesome-www/issues/7</a>. We'd be happy to have more input for that discussion and volunteers who help us migrate the content of this wiki to its replacement.
</p></div></div>
				<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">Mcabber notifications</span></h1>

				<div id="bodyContent" class="mw-body-content">
					<div id="siteSub">From awesome</div>
					<div id="contentSub"></div>
										<div id="jump-to-nav" class="mw-jump">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>

					<!-- start content -->
					<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><p>Mcabber is a great console based xmpp client with e2e (pgp and otr). By default the only way to see that you got a new message is the urgent hint set by mcabber and shown by awesome if configured correctly. I used gajim before and liked the notifications via naughty. This text is about enhancing your mcabber and awesome to inform you about your latest chat messages and status changes of your contacts. So lets get naughty&#160;;)
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#mcabber_configuration"><span class="tocnumber">1</span> <span class="toctext">mcabber configuration</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#awesome_configuration"><span class="tocnumber">2</span> <span class="toctext">awesome configuration</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Icons"><span class="tocnumber">3</span> <span class="toctext">Icons</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Event_Alternative"><span class="tocnumber">4</span> <span class="toctext">Event Alternative</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="mcabber_configuration">mcabber configuration</span></h2>
<p>mcabber has support for an external hook invoked if something happened. We use this for our notification.
The relevant parts are the following:
</p>
<pre>
set events_command = ~/.mcabber/event.sh
set events_ignore_active_window = 0
set event_log_files = 1
set event_log_dir = /tmp
</pre>
<p>As you can see we need a shellscript wrapper that pushes the bits to awesome.
</p><p>~/.mcabber/event.sh
</p>
<pre>
#!/bin/sh
echo &quot;mcabber_event_hook('$1', '$2', '$3', '$4')&quot; | awesome-client
</pre>
<p>Just an information about security. The shellscript above can easily be exploited locally e.g.:
</p>
<pre>./event.sh &quot;');awful.util.spawn('xterm'); --&quot;</pre>
<p>However the data sent by mcabber cannot contain the tick char (') that would be needed for this exploit. The only possible data chunk may containing illegal data would be the node of the jid, but again the tick char is <a rel="nofollow" class="external text" href="http://xmpp.org/extensions/xep-0106.html#intro">forbidden</a>.
</p><p>Anyway if you really dont trust incoming data you could replace the tick char everywhere with a sed command e.g.
</p>
<pre>echo &quot;mcabber_event_hook('`echo $1 | sed -e &quot;s/'/_/g&quot;`', ...</pre>
<h2><span class="mw-headline" id="awesome_configuration">awesome configuration</span></h2>
<p>Next you have to set up your rc.lua
</p><p>First add the profiles for status changes
</p>
<pre>
naughty.config.presets.online = {
    bg = &quot;#1f880e80&quot;,
    fg = &quot;#ffffff&quot;,
}
naughty.config.presets.chat = naughty.config.presets.online
naughty.config.presets.away = {
    bg = &quot;#eb4b1380&quot;,
    fg = &quot;#ffffff&quot;,
}
naughty.config.presets.xa = {
    bg = &quot;#65000080&quot;,
    fg = &quot;#ffffff&quot;,
}
naughty.config.presets.dnd = {
    bg = &quot;#65340080&quot;,
    fg = &quot;#ffffff&quot;,
}
naughty.config.presets.invisible = {
    bg = &quot;#ffffff80&quot;,
    fg = &quot;#000000&quot;,
}
naughty.config.presets.offline = {
    bg = &quot;#64636380&quot;,
    fg = &quot;#ffffff&quot;,
}
naughty.config.presets.requested = naughty.config.presets.offline
naughty.config.presets.error = {
    bg = &quot;#ff000080&quot;,
    fg = &quot;#ffffff&quot;,
}
</pre>
<p>After that we add the function that handles the mcabber hook events.
You have to change the variable "muc_nick" if you want awesome to hide your own MUC messages but only incoming messages.
</p>
<pre>
muc_nick = &quot;your_muc_nickname&quot;

function mcabber_event_hook(kind, direction, jid, msg)
    if kind == &quot;MSG&quot; then
        if direction == &quot;IN&quot; or direction == &quot;MUC&quot; then
            local filehandle = io.open(msg)
            local txt = filehandle:read(&quot;*all&quot;)
            filehandle:close()
            awful.util.spawn(&quot;rm &quot;..msg)
            if direction == &quot;MUC&quot; and txt:match(&quot;^&lt;&quot; .. muc_nick .. &quot;&gt;&quot;) then
                return
            end
            naughty.notify{
                icon = &quot;chat_msg_recv&quot;,
                text = awful.util.escape(txt),
                title = jid
            }
        end
    elseif kind == &quot;STATUS&quot; then
        local mapping = {
            [ &quot;O&quot; ] = &quot;online&quot;,
            [ &quot;F&quot; ] = &quot;chat&quot;,
            [ &quot;A&quot; ] = &quot;away&quot;,
            [ &quot;N&quot; ] = &quot;xa&quot;,
            [ &quot;D&quot; ] = &quot;dnd&quot;,
            [ &quot;I&quot; ] = &quot;invisible&quot;,
            [ &quot;_&quot; ] = &quot;offline&quot;,
            [ &quot;?&quot; ] = &quot;error&quot;,
            [ &quot;X&quot; ] = &quot;requested&quot;
        }
        local status = mapping[direction]
        local iconstatus = status
        if not status then
            status = &quot;error&quot;
        end
        if jid:match(&quot;icq&quot;) then
            iconstatus = &quot;icq/&quot; .. status
        end
        naughty.notify{
            preset = naughty.config.presets[status],
            text = jid,
            icon = iconstatus
        }
    end
end
</pre>
<p>As you can see I use the gajim icons for the notifications, you may also want to use them.
In the script above I also match for "icq" which is my icq transport, so the icq icons will be used but not the xmpp ones.
</p>
<h2><span class="mw-headline" id="Icons">Icons</span></h2>
<p>Add this to your rc.lua
</p>
<pre>
naughty.config.icon_dirs = { os.getenv(&quot;HOME&quot;) .. &quot;.config/awesome/naughtyicons/&quot;,  &quot;/usr/share/pixmaps/&quot; }
</pre>
<p>Create the directory ~/.config/awesome/naughtyicons/ extract the contents of the <a rel="nofollow" class="external text" href="http://www.ring0.de/icons.tar.gz">tarball</a> (<i>this link does not work</i>) there.
</p>
<h2><span class="mw-headline" id="Event_Alternative">Event Alternative</span></h2>
<p>A basic alternative is the following MCabber event script:
</p><p>--<a href="/w/index.php?title=User:Pnevma&amp;action=edit&amp;redlink=1" class="new" title="User:Pnevma (page does not exist)">Pnevma</a> 05:51, 29 March 2010 (UTC) Warning: This was made by a user with minimum understanding of Bash and LUA, it may do something bad! Could a more adept user check it and remove this warning/script if necessary? I've been using it for a while and everything seems fine.
</p>
<pre>
#!/bin/sh

if [ $1 = &quot;MSG&quot; ]; then
  case &quot;$2&quot; in
    IN)
      if [ -n &quot;$4&quot; -a -f &quot;$4&quot; ]; then
        message=&quot;$(cat $4)&quot;
        echo 'naughty.notify({title = &quot;'$3'&quot;, text = &quot;'&quot;$1: $message&quot;'&quot;})' | awesome-client
        rm $4
      fi
     &#160;;;
    MUC)
      if [ -n &quot;$4&quot; &amp;&amp; -f &quot;$4&quot; ]; then
        message=&quot;$(cat $4)&quot;
        echo 'naughty.notify({title = &quot;'$3'&quot;, text = &quot;'&quot;$1: $message&quot;'&quot;})' | awesome-client
        rm $4
      fi
     &#160;;;
    OUT)
        echo &gt; /dev/null
     &#160;;;
  esac
elif [ $1 = &quot;STATUS&quot; ]; then
  case &quot;$2&quot; in
    _)
      echo 'naughty.notify({title = &quot;'$3'&quot;, text = &quot;'&quot;$1: has signed off.&quot;'&quot;})' | awesome-client
    &#160;;;
    O)
      echo 'naughty.notify({title = &quot;'$3'&quot;, text = &quot;'&quot;$1: is now online.&quot;'&quot;})' | awesome-client
    &#160;;;
    F)
      echo 'naughty.notify({title = &quot;'$3'&quot;, text = &quot;'&quot;$1: is chatty.&quot;'&quot;})' | awesome-client
    &#160;;;
    A)
      echo 'naughty.notify({title = &quot;'$3'&quot;, text = &quot;'&quot;$1: has gone away.&quot;'&quot;})' | awesome-client
    &#160;;;
    N)
      echo 'naughty.notify({title = &quot;'$3'&quot;, text = &quot;'&quot;$1: is now extended away.&quot;'&quot;})' | awesome-client
    &#160;;;
    D)
     echo 'naughty.notify({title = &quot;'$3'&quot;, text = &quot;'&quot;$1: does not want to be disturbed.&quot;'&quot;})' | awesome-client
    &#160;;;
    I)
      echo 'naughty.notify({title = &quot;'$3'&quot;, text = &quot;'&quot;$1: is now invisible.&quot;'&quot;})' | awesome-client
    &#160;;;
   &#160;?)
      echo 'naughty.notify({title = &quot;'ERROR'&quot;, text = &quot;'&quot;Something broke.&quot;'&quot;})' | awesome-client
    &#160;;;
    X)
      echo 'naughty.notify({title = &quot;'$3'&quot;, text = &quot;'&quot;$1: has a request.&quot;'&quot;})' | awesome-client
    &#160;;;
  esac
elif [ $1 = &quot;UNREAD&quot; ]; then
  echo 'naughty.notify({title = &quot;'$1'&quot;, text = &quot;'&quot;There are $2 new messages.&quot;'&quot;})' | awesome-client
fi
</pre>

<!-- 
NewPP limit report
CPU time usage: 0.016 seconds
Real time usage: 0.020 seconds
Preprocessor visited node count: 81/1000000
Preprocessor generated node count: 180/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key awesome:pcache:idhash:315-0!*!0!!en!*!* and timestamp 20160514181345 and revision id 5504
 -->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="https://awesomewm.org/w/index.php?title=Mcabber_notifications&amp;oldid=5504">https://awesomewm.org/w/index.php?title=Mcabber_notifications&amp;oldid=5504</a>"</div>
					<div id='catlinks' class='catlinks'><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="/wiki/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="/wiki/Category:Awesome3" title="Category:Awesome3">Awesome3</a></li></ul></div></div>					<!-- end content -->
										<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div id="column-one">
			<h2>Navigation menu</h2>
					<div id="p-cactions" class="portlet" role="navigation">
			<h3>Views</h3>

			<div class="pBody">
				<ul>
				<li id="ca-nstab-main" class="selected"><a href="/wiki/Mcabber_notifications" title="View the content page [c]" accesskey="c">Page</a></li>
				<li id="ca-talk" class="new"><a href="/w/index.php?title=Talk:Mcabber_notifications&amp;action=edit&amp;redlink=1" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				<li id="ca-edit"><a href="/w/index.php?title=Mcabber_notifications&amp;action=edit" title="You can edit this page. Please use the preview button before saving [e]" accesskey="e">Edit</a></li>
				<li id="ca-history"><a href="/w/index.php?title=Mcabber_notifications&amp;action=history" rel="archives" title="Past revisions of this page [h]" accesskey="h">History</a></li>
				</ul>
							</div>
		</div>
				<div class="portlet" id="p-personal" role="navigation">
				<h3>Personal tools</h3>

				<div class="pBody">
					<ul>
													<li id="pt-anonuserpage"><a href="/wiki/User:95.90.224.24" class="new" title="The user page for the IP address you are editing as [.]" accesskey=".">95.90.224.24</a></li>
													<li id="pt-anontalk"><a href="/wiki/User_talk:95.90.224.24" class="new" title="Discussion about edits from this IP address [n]" accesskey="n">Talk for this IP address</a></li>
													<li id="pt-login"><a href="/w/index.php?title=Special:UserLogin&amp;returnto=Mcabber+notifications&amp;returntoquery=printable%3Dyes" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
											</ul>
				</div>
			</div>
			<div class="portlet" id="p-logo" role="banner">
				<a href="/wiki/Main_Page" style="background-image: url(/images/icons/aw_64.png);" title="Visit the main page"></a>
			</div>
				<div class="generated-sidebar portlet" id="p-navigation" role="navigation">
		<h3>Navigation</h3>
		<div class='pBody'>
							<ul>
											<li id="n-mainpage-description"><a href="/wiki/Main_Page" title="Visit the main page [z]" accesskey="z">Main page</a></li>
											<li id="n-Homepage"><a href="http://awesome.naquadah.org" rel="nofollow">Homepage</a></li>
											<li id="n-recentchanges"><a href="/wiki/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
											<li id="n-randompage"><a href="/wiki/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
											<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>
									</ul>
					</div>
		</div>
			<div id="p-search" class="portlet" role="search">
			<h3><label for="searchInput">Search</label></h3>

			<div id="searchBody" class="pBody">
				<form action="/w/index.php" id="searchform">
					<input type='hidden' name="title" value="Special:Search"/>
					<input type="search" name="search" placeholder="Search" title="Search awesome [f]" accesskey="f" id="searchInput" />
					<input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchGoButton" class="searchButton" />&#160;
						<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton" />
				</form>

							</div>
		</div>
			<div class="portlet" id="p-tb" role="navigation">
			<h3>Tools</h3>

			<div class="pBody">
				<ul>
											<li id="t-whatlinkshere"><a href="/wiki/Special:WhatLinksHere/Mcabber_notifications" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
											<li id="t-recentchangeslinked"><a href="/wiki/Special:RecentChangesLinked/Mcabber_notifications" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
											<li id="t-specialpages"><a href="/wiki/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
											<li id="t-permalink"><a href="/w/index.php?title=Mcabber_notifications&amp;oldid=5504" title="Permanent link to this revision of the page">Permanent link</a></li>
											<li id="t-info"><a href="/w/index.php?title=Mcabber_notifications&amp;action=info">Page information</a></li>
									</ul>
							</div>
		</div>
			</div><!-- end of the left (by default at least) column -->
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
						<div id="f-copyrightico">
									<a href="https://creativecommons.org/licenses/by/3.0/"><img src="https://i.creativecommons.org/l/by/3.0/88x31.png" alt="Attribution 3.0 Unported" width="88" height="31" /></a>
							</div>
					<div id="f-poweredbyico">
									<a href="//www.mediawiki.org/"><img src="/w/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>
							</div>
					<ul id="f-list">
									<li id="lastmod"> This page was last modified on 8 June 2012, at 15:40.</li>
									<li id="viewcount">This page has been accessed 19,387 times.</li>
									<li id="copyright">Content is available under <a class="external" rel="nofollow" href="https://creativecommons.org/licenses/by/3.0/">Attribution 3.0 Unported</a> unless otherwise noted.</li>
									<li id="privacy"><a href="/wiki/awesome:Privacy_policy" title="awesome:Privacy policy">Privacy policy</a></li>
									<li id="about"><a href="/wiki/awesome:About" title="awesome:About">About awesome</a></li>
									<li id="disclaimer"><a href="/wiki/awesome:General_disclaimer" title="awesome:General disclaimer">Disclaimers</a></li>
							</ul>
		</div>
		</div>
		<script>/*<![CDATA[*/window.jQuery && jQuery.ready();/*]]>*/</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
document.write("\u003Cscript src=\"https://awesomewm.org/w/load.php?debug=false\u0026amp;lang=en\u0026amp;modules=site\u0026amp;only=scripts\u0026amp;printable=1\u0026amp;skin=monobook\u0026amp;*\"\u003E\u003C/script\u003E");
}</script>
<script>if(window.mw){
mw.config.set({"wgBackendResponseTime":135});
}</script></body></html>